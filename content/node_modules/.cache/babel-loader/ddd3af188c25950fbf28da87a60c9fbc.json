{"ast":null,"code":"var iota = require(\"iota-array\");\n\nvar isBuffer = require(\"is-buffer\");\n\nvar hasTypedArrays = typeof Float64Array !== \"undefined\";\n\nfunction compare1st(a, b) {\n  return a[0] - b[0];\n}\n\nfunction order() {\n  var stride = this.stride;\n  var terms = new Array(stride.length);\n  var i;\n\n  for (i = 0; i < terms.length; ++i) {\n    terms[i] = [Math.abs(stride[i]), i];\n  }\n\n  terms.sort(compare1st);\n  var result = new Array(terms.length);\n\n  for (i = 0; i < result.length; ++i) {\n    result[i] = terms[i][1];\n  }\n\n  return result;\n}\n\nfunction compileConstructor(dtype, dimension) {\n  var className = [\"View\", dimension, \"d\", dtype].join(\"\");\n\n  if (dimension < 0) {\n    className = \"View_Nil\" + dtype;\n  }\n\n  var useGetters = dtype === \"generic\";\n\n  if (dimension === -1) {\n    //Special case for trivial arrays\n    var code = \"function \" + className + \"(a){this.data=a;};\\\nvar proto=\" + className + \".prototype;\\\nproto.dtype='\" + dtype + \"';\\\nproto.index=function(){return -1};\\\nproto.size=0;\\\nproto.dimension=-1;\\\nproto.shape=proto.stride=proto.order=[];\\\nproto.lo=proto.hi=proto.transpose=proto.step=\\\nfunction(){return new \" + className + \"(this.data);};\\\nproto.get=proto.set=function(){};\\\nproto.pick=function(){return null};\\\nreturn function construct_\" + className + \"(a){return new \" + className + \"(a);}\";\n    var procedure = new Function(code);\n    return procedure();\n  } else if (dimension === 0) {\n    //Special case for 0d arrays\n    var code = \"function \" + className + \"(a,d) {\\\nthis.data = a;\\\nthis.offset = d\\\n};\\\nvar proto=\" + className + \".prototype;\\\nproto.dtype='\" + dtype + \"';\\\nproto.index=function(){return this.offset};\\\nproto.dimension=0;\\\nproto.size=1;\\\nproto.shape=\\\nproto.stride=\\\nproto.order=[];\\\nproto.lo=\\\nproto.hi=\\\nproto.transpose=\\\nproto.step=function \" + className + \"_copy() {\\\nreturn new \" + className + \"(this.data,this.offset)\\\n};\\\nproto.pick=function \" + className + \"_pick(){\\\nreturn TrivialArray(this.data);\\\n};\\\nproto.valueOf=proto.get=function \" + className + \"_get(){\\\nreturn \" + (useGetters ? \"this.data.get(this.offset)\" : \"this.data[this.offset]\") + \"};\\\nproto.set=function \" + className + \"_set(v){\\\nreturn \" + (useGetters ? \"this.data.set(this.offset,v)\" : \"this.data[this.offset]=v\") + \"\\\n};\\\nreturn function construct_\" + className + \"(a,b,c,d){return new \" + className + \"(a,d)}\";\n    var procedure = new Function(\"TrivialArray\", code);\n    return procedure(CACHED_CONSTRUCTORS[dtype][0]);\n  }\n\n  var code = [\"'use strict'\"]; //Create constructor for view\n\n  var indices = iota(dimension);\n  var args = indices.map(function (i) {\n    return \"i\" + i;\n  });\n  var index_str = \"this.offset+\" + indices.map(function (i) {\n    return \"this.stride[\" + i + \"]*i\" + i;\n  }).join(\"+\");\n  var shapeArg = indices.map(function (i) {\n    return \"b\" + i;\n  }).join(\",\");\n  var strideArg = indices.map(function (i) {\n    return \"c\" + i;\n  }).join(\",\");\n  code.push(\"function \" + className + \"(a,\" + shapeArg + \",\" + strideArg + \",d){this.data=a\", \"this.shape=[\" + shapeArg + \"]\", \"this.stride=[\" + strideArg + \"]\", \"this.offset=d|0}\", \"var proto=\" + className + \".prototype\", \"proto.dtype='\" + dtype + \"'\", \"proto.dimension=\" + dimension); //view.size:\n\n  code.push(\"Object.defineProperty(proto,'size',{get:function \" + className + \"_size(){\\\nreturn \" + indices.map(function (i) {\n    return \"this.shape[\" + i + \"]\";\n  }).join(\"*\"), \"}})\"); //view.order:\n\n  if (dimension === 1) {\n    code.push(\"proto.order=[0]\");\n  } else {\n    code.push(\"Object.defineProperty(proto,'order',{get:\");\n\n    if (dimension < 4) {\n      code.push(\"function \" + className + \"_order(){\");\n\n      if (dimension === 2) {\n        code.push(\"return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})\");\n      } else if (dimension === 3) {\n        code.push(\"var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\\\nif(s0>s1){\\\nif(s1>s2){\\\nreturn [2,1,0];\\\n}else if(s0>s2){\\\nreturn [1,2,0];\\\n}else{\\\nreturn [1,0,2];\\\n}\\\n}else if(s0>s2){\\\nreturn [2,0,1];\\\n}else if(s2>s1){\\\nreturn [0,1,2];\\\n}else{\\\nreturn [0,2,1];\\\n}}})\");\n      }\n    } else {\n      code.push(\"ORDER})\");\n    }\n  } //view.set(i0, ..., v):\n\n\n  code.push(\"proto.set=function \" + className + \"_set(\" + args.join(\",\") + \",v){\");\n\n  if (useGetters) {\n    code.push(\"return this.data.set(\" + index_str + \",v)}\");\n  } else {\n    code.push(\"return this.data[\" + index_str + \"]=v}\");\n  } //view.get(i0, ...):\n\n\n  code.push(\"proto.get=function \" + className + \"_get(\" + args.join(\",\") + \"){\");\n\n  if (useGetters) {\n    code.push(\"return this.data.get(\" + index_str + \")}\");\n  } else {\n    code.push(\"return this.data[\" + index_str + \"]}\");\n  } //view.index:\n\n\n  code.push(\"proto.index=function \" + className + \"_index(\", args.join(), \"){return \" + index_str + \"}\"); //view.hi():\n\n  code.push(\"proto.hi=function \" + className + \"_hi(\" + args.join(\",\") + \"){return new \" + className + \"(this.data,\" + indices.map(function (i) {\n    return [\"(typeof i\", i, \"!=='number'||i\", i, \"<0)?this.shape[\", i, \"]:i\", i, \"|0\"].join(\"\");\n  }).join(\",\") + \",\" + indices.map(function (i) {\n    return \"this.stride[\" + i + \"]\";\n  }).join(\",\") + \",this.offset)}\"); //view.lo():\n\n  var a_vars = indices.map(function (i) {\n    return \"a\" + i + \"=this.shape[\" + i + \"]\";\n  });\n  var c_vars = indices.map(function (i) {\n    return \"c\" + i + \"=this.stride[\" + i + \"]\";\n  });\n  code.push(\"proto.lo=function \" + className + \"_lo(\" + args.join(\",\") + \"){var b=this.offset,d=0,\" + a_vars.join(\",\") + \",\" + c_vars.join(\",\"));\n\n  for (var i = 0; i < dimension; ++i) {\n    code.push(\"if(typeof i\" + i + \"==='number'&&i\" + i + \">=0){\\\nd=i\" + i + \"|0;\\\nb+=c\" + i + \"*d;\\\na\" + i + \"-=d}\");\n  }\n\n  code.push(\"return new \" + className + \"(this.data,\" + indices.map(function (i) {\n    return \"a\" + i;\n  }).join(\",\") + \",\" + indices.map(function (i) {\n    return \"c\" + i;\n  }).join(\",\") + \",b)}\"); //view.step():\n\n  code.push(\"proto.step=function \" + className + \"_step(\" + args.join(\",\") + \"){var \" + indices.map(function (i) {\n    return \"a\" + i + \"=this.shape[\" + i + \"]\";\n  }).join(\",\") + \",\" + indices.map(function (i) {\n    return \"b\" + i + \"=this.stride[\" + i + \"]\";\n  }).join(\",\") + \",c=this.offset,d=0,ceil=Math.ceil\");\n\n  for (var i = 0; i < dimension; ++i) {\n    code.push(\"if(typeof i\" + i + \"==='number'){\\\nd=i\" + i + \"|0;\\\nif(d<0){\\\nc+=b\" + i + \"*(a\" + i + \"-1);\\\na\" + i + \"=ceil(-a\" + i + \"/d)\\\n}else{\\\na\" + i + \"=ceil(a\" + i + \"/d)\\\n}\\\nb\" + i + \"*=d\\\n}\");\n  }\n\n  code.push(\"return new \" + className + \"(this.data,\" + indices.map(function (i) {\n    return \"a\" + i;\n  }).join(\",\") + \",\" + indices.map(function (i) {\n    return \"b\" + i;\n  }).join(\",\") + \",c)}\"); //view.transpose():\n\n  var tShape = new Array(dimension);\n  var tStride = new Array(dimension);\n\n  for (var i = 0; i < dimension; ++i) {\n    tShape[i] = \"a[i\" + i + \"]\";\n    tStride[i] = \"b[i\" + i + \"]\";\n  }\n\n  code.push(\"proto.transpose=function \" + className + \"_transpose(\" + args + \"){\" + args.map(function (n, idx) {\n    return n + \"=(\" + n + \"===undefined?\" + idx + \":\" + n + \"|0)\";\n  }).join(\";\"), \"var a=this.shape,b=this.stride;return new \" + className + \"(this.data,\" + tShape.join(\",\") + \",\" + tStride.join(\",\") + \",this.offset)}\"); //view.pick():\n\n  code.push(\"proto.pick=function \" + className + \"_pick(\" + args + \"){var a=[],b=[],c=this.offset\");\n\n  for (var i = 0; i < dimension; ++i) {\n    code.push(\"if(typeof i\" + i + \"==='number'&&i\" + i + \">=0){c=(c+this.stride[\" + i + \"]*i\" + i + \")|0}else{a.push(this.shape[\" + i + \"]);b.push(this.stride[\" + i + \"])}\");\n  }\n\n  code.push(\"var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}\"); //Add return statement\n\n  code.push(\"return function construct_\" + className + \"(data,shape,stride,offset){return new \" + className + \"(data,\" + indices.map(function (i) {\n    return \"shape[\" + i + \"]\";\n  }).join(\",\") + \",\" + indices.map(function (i) {\n    return \"stride[\" + i + \"]\";\n  }).join(\",\") + \",offset)}\"); //Compile procedure\n\n  var procedure = new Function(\"CTOR_LIST\", \"ORDER\", code.join(\"\\n\"));\n  return procedure(CACHED_CONSTRUCTORS[dtype], order);\n}\n\nfunction arrayDType(data) {\n  if (isBuffer(data)) {\n    return \"buffer\";\n  }\n\n  if (hasTypedArrays) {\n    switch (Object.prototype.toString.call(data)) {\n      case \"[object Float64Array]\":\n        return \"float64\";\n\n      case \"[object Float32Array]\":\n        return \"float32\";\n\n      case \"[object Int8Array]\":\n        return \"int8\";\n\n      case \"[object Int16Array]\":\n        return \"int16\";\n\n      case \"[object Int32Array]\":\n        return \"int32\";\n\n      case \"[object Uint8Array]\":\n        return \"uint8\";\n\n      case \"[object Uint16Array]\":\n        return \"uint16\";\n\n      case \"[object Uint32Array]\":\n        return \"uint32\";\n\n      case \"[object Uint8ClampedArray]\":\n        return \"uint8_clamped\";\n\n      case \"[object BigInt64Array]\":\n        return \"bigint64\";\n\n      case \"[object BigUint64Array]\":\n        return \"biguint64\";\n    }\n  }\n\n  if (Array.isArray(data)) {\n    return \"array\";\n  }\n\n  return \"generic\";\n}\n\nvar CACHED_CONSTRUCTORS = {\n  \"float32\": [],\n  \"float64\": [],\n  \"int8\": [],\n  \"int16\": [],\n  \"int32\": [],\n  \"uint8\": [],\n  \"uint16\": [],\n  \"uint32\": [],\n  \"array\": [],\n  \"uint8_clamped\": [],\n  \"bigint64\": [],\n  \"biguint64\": [],\n  \"buffer\": [],\n  \"generic\": []\n};\n\n(function () {\n  for (var id in CACHED_CONSTRUCTORS) {\n    CACHED_CONSTRUCTORS[id].push(compileConstructor(id, -1));\n  }\n});\n\nfunction wrappedNDArrayCtor(data, shape, stride, offset) {\n  if (data === undefined) {\n    var ctor = CACHED_CONSTRUCTORS.array[0];\n    return ctor([]);\n  } else if (typeof data === \"number\") {\n    data = [data];\n  }\n\n  if (shape === undefined) {\n    shape = [data.length];\n  }\n\n  var d = shape.length;\n\n  if (stride === undefined) {\n    stride = new Array(d);\n\n    for (var i = d - 1, sz = 1; i >= 0; --i) {\n      stride[i] = sz;\n      sz *= shape[i];\n    }\n  }\n\n  if (offset === undefined) {\n    offset = 0;\n\n    for (var i = 0; i < d; ++i) {\n      if (stride[i] < 0) {\n        offset -= (shape[i] - 1) * stride[i];\n      }\n    }\n  }\n\n  var dtype = arrayDType(data);\n  var ctor_list = CACHED_CONSTRUCTORS[dtype];\n\n  while (ctor_list.length <= d + 1) {\n    ctor_list.push(compileConstructor(dtype, ctor_list.length - 1));\n  }\n\n  var ctor = ctor_list[d + 1];\n  return ctor(data, shape, stride, offset);\n}\n\nmodule.exports = wrappedNDArrayCtor;","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/ndarray/ndarray.js"],"names":["iota","require","isBuffer","hasTypedArrays","Float64Array","compare1st","a","b","order","stride","terms","Array","length","i","Math","abs","sort","result","compileConstructor","dtype","dimension","className","join","useGetters","code","procedure","Function","CACHED_CONSTRUCTORS","indices","args","map","index_str","shapeArg","strideArg","push","a_vars","c_vars","tShape","tStride","n","idx","arrayDType","data","Object","prototype","toString","call","isArray","id","wrappedNDArrayCtor","shape","offset","undefined","ctor","array","d","sz","ctor_list","module","exports"],"mappings":"AAAA,IAAIA,IAAI,GAAGC,OAAO,CAAC,YAAD,CAAlB;;AACA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,WAAD,CAAtB;;AAEA,IAAIE,cAAc,GAAM,OAAOC,YAAR,KAA0B,WAAjD;;AAEA,SAASC,UAAT,CAAoBC,CAApB,EAAuBC,CAAvB,EAA0B;AACxB,SAAOD,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAf;AACD;;AAED,SAASC,KAAT,GAAiB;AACf,MAAIC,MAAM,GAAG,KAAKA,MAAlB;AACA,MAAIC,KAAK,GAAG,IAAIC,KAAJ,CAAUF,MAAM,CAACG,MAAjB,CAAZ;AACA,MAAIC,CAAJ;;AACA,OAAIA,CAAC,GAAC,CAAN,EAASA,CAAC,GAACH,KAAK,CAACE,MAAjB,EAAyB,EAAEC,CAA3B,EAA8B;AAC5BH,IAAAA,KAAK,CAACG,CAAD,CAAL,GAAW,CAACC,IAAI,CAACC,GAAL,CAASN,MAAM,CAACI,CAAD,CAAf,CAAD,EAAsBA,CAAtB,CAAX;AACD;;AACDH,EAAAA,KAAK,CAACM,IAAN,CAAWX,UAAX;AACA,MAAIY,MAAM,GAAG,IAAIN,KAAJ,CAAUD,KAAK,CAACE,MAAhB,CAAb;;AACA,OAAIC,CAAC,GAAC,CAAN,EAASA,CAAC,GAACI,MAAM,CAACL,MAAlB,EAA0B,EAAEC,CAA5B,EAA+B;AAC7BI,IAAAA,MAAM,CAACJ,CAAD,CAAN,GAAYH,KAAK,CAACG,CAAD,CAAL,CAAS,CAAT,CAAZ;AACD;;AACD,SAAOI,MAAP;AACD;;AAED,SAASC,kBAAT,CAA4BC,KAA5B,EAAmCC,SAAnC,EAA8C;AAC5C,MAAIC,SAAS,GAAG,CAAC,MAAD,EAASD,SAAT,EAAoB,GAApB,EAAyBD,KAAzB,EAAgCG,IAAhC,CAAqC,EAArC,CAAhB;;AACA,MAAGF,SAAS,GAAG,CAAf,EAAkB;AAChBC,IAAAA,SAAS,GAAG,aAAaF,KAAzB;AACD;;AACD,MAAII,UAAU,GAAIJ,KAAK,KAAK,SAA5B;;AAEA,MAAGC,SAAS,KAAK,CAAC,CAAlB,EAAqB;AACnB;AACA,QAAII,IAAI,GACN,cAAYH,SAAZ,GAAsB;AAC5B,WADM,GACMA,SADN,GACgB;AACtB,cAFM,GAESF,KAFT,GAEe;AACrB;AACA;AACA;AACA;AACA;AACA,uBARM,GAQkBE,SARlB,GAQ4B;AAClC;AACA;AACA,2BAXM,GAWsBA,SAXtB,GAWgC,iBAXhC,GAWkDA,SAXlD,GAW4D,OAZ9D;AAaA,QAAII,SAAS,GAAG,IAAIC,QAAJ,CAAaF,IAAb,CAAhB;AACA,WAAOC,SAAS,EAAhB;AACD,GAjBD,MAiBO,IAAGL,SAAS,KAAK,CAAjB,EAAoB;AACzB;AACA,QAAII,IAAI,GACN,cAAYH,SAAZ,GAAsB;AAC5B;AACA;AACA;AACA,WAJM,GAIMA,SAJN,GAIgB;AACtB,cALM,GAKSF,KALT,GAKe;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAfM,GAegBE,SAfhB,GAe0B;AAChC,YAhBM,GAgBOA,SAhBP,GAgBiB;AACvB;AACA,qBAlBM,GAkBgBA,SAlBhB,GAkB0B;AAChC;AACA;AACA,kCArBM,GAqB6BA,SArB7B,GAqBuC;AAC7C,QAtBM,IAsBIE,UAAU,GAAG,4BAAH,GAAkC,wBAtBhD,IAuBN;AACA,oBAxBM,GAwBeF,SAxBf,GAwByB;AAC/B,QAzBM,IAyBIE,UAAU,GAAG,8BAAH,GAAoC,0BAzBlD,IAyB8E;AACpF;AACA,2BA3BM,GA2BsBF,SA3BtB,GA2BgC,uBA3BhC,GA2BwDA,SA3BxD,GA2BkE,QA5BpE;AA6BA,QAAII,SAAS,GAAG,IAAIC,QAAJ,CAAa,cAAb,EAA6BF,IAA7B,CAAhB;AACA,WAAOC,SAAS,CAACE,mBAAmB,CAACR,KAAD,CAAnB,CAA2B,CAA3B,CAAD,CAAhB;AACD;;AAED,MAAIK,IAAI,GAAG,CAAC,cAAD,CAAX,CA3D4C,CA6D5C;;AACA,MAAII,OAAO,GAAG5B,IAAI,CAACoB,SAAD,CAAlB;AACA,MAAIS,IAAI,GAAGD,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AAAE,WAAO,MAAIA,CAAX;AAAc,GAAxC,CAAX;AACA,MAAIkB,SAAS,GAAG,iBAAiBH,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACnD,WAAO,iBAAiBA,CAAjB,GAAqB,KAArB,GAA6BA,CAApC;AACD,GAF4B,EAE1BS,IAF0B,CAErB,GAFqB,CAAjC;AAGA,MAAIU,QAAQ,GAAGJ,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACnC,WAAO,MAAIA,CAAX;AACD,GAFY,EAEVS,IAFU,CAEL,GAFK,CAAf;AAGA,MAAIW,SAAS,GAAGL,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACpC,WAAO,MAAIA,CAAX;AACD,GAFa,EAEXS,IAFW,CAEN,GAFM,CAAhB;AAGAE,EAAAA,IAAI,CAACU,IAAL,CACE,cAAYb,SAAZ,GAAsB,KAAtB,GAA8BW,QAA9B,GAAyC,GAAzC,GAA+CC,SAA/C,GAA2D,iBAD7D,EAEI,iBAAiBD,QAAjB,GAA4B,GAFhC,EAGI,kBAAkBC,SAAlB,GAA8B,GAHlC,EAII,kBAJJ,EAKE,eAAaZ,SAAb,GAAuB,YALzB,EAME,kBAAgBF,KAAhB,GAAsB,GANxB,EAOE,qBAAmBC,SAPrB,EAzE4C,CAkF5C;;AACAI,EAAAA,IAAI,CAACU,IAAL,CAAU,sDAAoDb,SAApD,GAA8D;AAC1E,QADY,GACHO,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AAAE,WAAO,gBAAcA,CAAd,GAAgB,GAAvB;AAA4B,GAAtD,EAAwDS,IAAxD,CAA6D,GAA7D,CADP,EAEF,KAFE,EAnF4C,CAuF5C;;AACA,MAAGF,SAAS,KAAK,CAAjB,EAAoB;AAClBI,IAAAA,IAAI,CAACU,IAAL,CAAU,iBAAV;AACD,GAFD,MAEO;AACLV,IAAAA,IAAI,CAACU,IAAL,CAAU,2CAAV;;AACA,QAAGd,SAAS,GAAG,CAAf,EAAkB;AAChBI,MAAAA,IAAI,CAACU,IAAL,CAAU,cAAYb,SAAZ,GAAsB,WAAhC;;AACA,UAAGD,SAAS,KAAK,CAAjB,EAAoB;AAClBI,QAAAA,IAAI,CAACU,IAAL,CAAU,2EAAV;AACD,OAFD,MAEO,IAAGd,SAAS,KAAK,CAAjB,EAAoB;AACzBI,QAAAA,IAAI,CAACU,IAAL,CACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAhBQ;AAiBD;AACF,KAvBD,MAuBO;AACLV,MAAAA,IAAI,CAACU,IAAL,CAAU,SAAV;AACD;AACF,GAtH2C,CAwH5C;;;AACAV,EAAAA,IAAI,CAACU,IAAL,CACF,wBAAsBb,SAAtB,GAAgC,OAAhC,GAAwCQ,IAAI,CAACP,IAAL,CAAU,GAAV,CAAxC,GAAuD,MADrD;;AAEA,MAAGC,UAAH,EAAe;AACbC,IAAAA,IAAI,CAACU,IAAL,CAAU,0BAAwBH,SAAxB,GAAkC,MAA5C;AACD,GAFD,MAEO;AACLP,IAAAA,IAAI,CAACU,IAAL,CAAU,sBAAoBH,SAApB,GAA8B,MAAxC;AACD,GA/H2C,CAiI5C;;;AACAP,EAAAA,IAAI,CAACU,IAAL,CAAU,wBAAsBb,SAAtB,GAAgC,OAAhC,GAAwCQ,IAAI,CAACP,IAAL,CAAU,GAAV,CAAxC,GAAuD,IAAjE;;AACA,MAAGC,UAAH,EAAe;AACbC,IAAAA,IAAI,CAACU,IAAL,CAAU,0BAAwBH,SAAxB,GAAkC,IAA5C;AACD,GAFD,MAEO;AACLP,IAAAA,IAAI,CAACU,IAAL,CAAU,sBAAoBH,SAApB,GAA8B,IAAxC;AACD,GAvI2C,CAyI5C;;;AACAP,EAAAA,IAAI,CAACU,IAAL,CACE,0BAAwBb,SAAxB,GAAkC,SADpC,EAC+CQ,IAAI,CAACP,IAAL,EAD/C,EAC4D,cAAYS,SAAZ,GAAsB,GADlF,EA1I4C,CA6I5C;;AACAP,EAAAA,IAAI,CAACU,IAAL,CAAU,uBAAqBb,SAArB,GAA+B,MAA/B,GAAsCQ,IAAI,CAACP,IAAL,CAAU,GAAV,CAAtC,GAAqD,eAArD,GAAqED,SAArE,GAA+E,aAA/E,GACRO,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,CAAC,WAAD,EAAaA,CAAb,EAAe,gBAAf,EAAgCA,CAAhC,EAAkC,iBAAlC,EAAqDA,CAArD,EAAwD,KAAxD,EAA+DA,CAA/D,EAAiE,IAAjE,EAAuES,IAAvE,CAA4E,EAA5E,CAAP;AACD,GAFD,EAEGA,IAFH,CAEQ,GAFR,CADQ,GAGK,GAHL,GAIRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,iBAAeA,CAAf,GAAmB,GAA1B;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CAJQ,GAMK,gBANf,EA9I4C,CAsJ5C;;AACA,MAAIa,MAAM,GAAGP,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AAAE,WAAO,MAAIA,CAAJ,GAAM,cAAN,GAAqBA,CAArB,GAAuB,GAA9B;AAAmC,GAA7D,CAAb;AACA,MAAIuB,MAAM,GAAGR,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AAAE,WAAO,MAAIA,CAAJ,GAAM,eAAN,GAAsBA,CAAtB,GAAwB,GAA/B;AAAoC,GAA9D,CAAb;AACAW,EAAAA,IAAI,CAACU,IAAL,CAAU,uBAAqBb,SAArB,GAA+B,MAA/B,GAAsCQ,IAAI,CAACP,IAAL,CAAU,GAAV,CAAtC,GAAqD,0BAArD,GAAgFa,MAAM,CAACb,IAAP,CAAY,GAAZ,CAAhF,GAAiG,GAAjG,GAAqGc,MAAM,CAACd,IAAP,CAAY,GAAZ,CAA/G;;AACA,OAAI,IAAIT,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACO,SAAf,EAA0B,EAAEP,CAA5B,EAA+B;AAC7BW,IAAAA,IAAI,CAACU,IAAL,CACJ,gBAAcrB,CAAd,GAAgB,gBAAhB,GAAiCA,CAAjC,GAAmC;AACnC,IADA,GACKA,CADL,GACO;AACP,KAFA,GAEMA,CAFN,GAEQ;AACR,EAHA,GAGGA,CAHH,GAGK,MAJD;AAKD;;AACDW,EAAAA,IAAI,CAACU,IAAL,CAAU,gBAAcb,SAAd,GAAwB,aAAxB,GACRO,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAIA,CAAX;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CADQ,GAGK,GAHL,GAIRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAIA,CAAX;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CAJQ,GAMK,MANf,EAjK4C,CAyK5C;;AACAE,EAAAA,IAAI,CAACU,IAAL,CAAU,yBAAuBb,SAAvB,GAAiC,QAAjC,GAA0CQ,IAAI,CAACP,IAAL,CAAU,GAAV,CAA1C,GAAyD,QAAzD,GACRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAIA,CAAJ,GAAM,cAAN,GAAqBA,CAArB,GAAuB,GAA9B;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CADQ,GAGK,GAHL,GAIRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAIA,CAAJ,GAAM,eAAN,GAAsBA,CAAtB,GAAwB,GAA/B;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CAJQ,GAMK,mCANf;;AAOA,OAAI,IAAIT,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACO,SAAf,EAA0B,EAAEP,CAA5B,EAA+B;AAC7BW,IAAAA,IAAI,CAACU,IAAL,CACJ,gBAAcrB,CAAd,GAAgB;AAChB,IADA,GACKA,CADL,GACO;AACP;AACA,KAHA,GAGMA,CAHN,GAGQ,KAHR,GAGcA,CAHd,GAGgB;AAChB,EAJA,GAIGA,CAJH,GAIK,UAJL,GAIgBA,CAJhB,GAIkB;AAClB;AACA,EANA,GAMGA,CANH,GAMK,SANL,GAMeA,CANf,GAMiB;AACjB;AACA,EARA,GAQGA,CARH,GAQK;AACL,EAVI;AAWD;;AACDW,EAAAA,IAAI,CAACU,IAAL,CAAU,gBAAcb,SAAd,GAAwB,aAAxB,GACRO,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAMA,CAAb;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CADQ,GAGK,GAHL,GAIRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,MAAMA,CAAb;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CAJQ,GAMK,MANf,EA9L4C,CAsM5C;;AACA,MAAIe,MAAM,GAAG,IAAI1B,KAAJ,CAAUS,SAAV,CAAb;AACA,MAAIkB,OAAO,GAAG,IAAI3B,KAAJ,CAAUS,SAAV,CAAd;;AACA,OAAI,IAAIP,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACO,SAAf,EAA0B,EAAEP,CAA5B,EAA+B;AAC7BwB,IAAAA,MAAM,CAACxB,CAAD,CAAN,GAAY,QAAMA,CAAN,GAAQ,GAApB;AACAyB,IAAAA,OAAO,CAACzB,CAAD,CAAP,GAAa,QAAMA,CAAN,GAAQ,GAArB;AACD;;AACDW,EAAAA,IAAI,CAACU,IAAL,CAAU,8BAA4Bb,SAA5B,GAAsC,aAAtC,GAAoDQ,IAApD,GAAyD,IAAzD,GACRA,IAAI,CAACC,GAAL,CAAS,UAASS,CAAT,EAAWC,GAAX,EAAgB;AAAE,WAAOD,CAAC,GAAG,IAAJ,GAAWA,CAAX,GAAe,eAAf,GAAiCC,GAAjC,GAAuC,GAAvC,GAA6CD,CAA7C,GAAiD,KAAxD;AAA8D,GAAzF,EAA2FjB,IAA3F,CAAgG,GAAhG,CADF,EAEE,+CAA6CD,SAA7C,GAAuD,aAAvD,GAAqEgB,MAAM,CAACf,IAAP,CAAY,GAAZ,CAArE,GAAsF,GAAtF,GAA0FgB,OAAO,CAAChB,IAAR,CAAa,GAAb,CAA1F,GAA4G,gBAF9G,EA7M4C,CAiN5C;;AACAE,EAAAA,IAAI,CAACU,IAAL,CAAU,yBAAuBb,SAAvB,GAAiC,QAAjC,GAA0CQ,IAA1C,GAA+C,+BAAzD;;AACA,OAAI,IAAIhB,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACO,SAAf,EAA0B,EAAEP,CAA5B,EAA+B;AAC7BW,IAAAA,IAAI,CAACU,IAAL,CAAU,gBAAcrB,CAAd,GAAgB,gBAAhB,GAAiCA,CAAjC,GAAmC,wBAAnC,GAA4DA,CAA5D,GAA8D,KAA9D,GAAoEA,CAApE,GAAsE,6BAAtE,GAAoGA,CAApG,GAAsG,wBAAtG,GAA+HA,CAA/H,GAAiI,KAA3I;AACD;;AACDW,EAAAA,IAAI,CAACU,IAAL,CAAU,8DAAV,EAtN4C,CAwN5C;;AACAV,EAAAA,IAAI,CAACU,IAAL,CAAU,+BAA6Bb,SAA7B,GAAuC,wCAAvC,GAAgFA,SAAhF,GAA0F,QAA1F,GACRO,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,WAASA,CAAT,GAAW,GAAlB;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CADQ,GAGK,GAHL,GAIRM,OAAO,CAACE,GAAR,CAAY,UAASjB,CAAT,EAAY;AACtB,WAAO,YAAUA,CAAV,GAAY,GAAnB;AACD,GAFD,EAEGS,IAFH,CAEQ,GAFR,CAJQ,GAMK,WANf,EAzN4C,CAiO5C;;AACA,MAAIG,SAAS,GAAG,IAAIC,QAAJ,CAAa,WAAb,EAA0B,OAA1B,EAAmCF,IAAI,CAACF,IAAL,CAAU,IAAV,CAAnC,CAAhB;AACA,SAAOG,SAAS,CAACE,mBAAmB,CAACR,KAAD,CAApB,EAA6BX,KAA7B,CAAhB;AACD;;AAED,SAASiC,UAAT,CAAoBC,IAApB,EAA0B;AACxB,MAAGxC,QAAQ,CAACwC,IAAD,CAAX,EAAmB;AACjB,WAAO,QAAP;AACD;;AACD,MAAGvC,cAAH,EAAmB;AACjB,YAAOwC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,IAA/B,CAAP;AACE,WAAK,uBAAL;AACE,eAAO,SAAP;;AACF,WAAK,uBAAL;AACE,eAAO,SAAP;;AACF,WAAK,oBAAL;AACE,eAAO,MAAP;;AACF,WAAK,qBAAL;AACE,eAAO,OAAP;;AACF,WAAK,qBAAL;AACE,eAAO,OAAP;;AACF,WAAK,qBAAL;AACE,eAAO,OAAP;;AACF,WAAK,sBAAL;AACE,eAAO,QAAP;;AACF,WAAK,sBAAL;AACE,eAAO,QAAP;;AACF,WAAK,4BAAL;AACE,eAAO,eAAP;;AACF,WAAK,wBAAL;AACE,eAAO,UAAP;;AACF,WAAK,yBAAL;AACE,eAAO,WAAP;AAtBJ;AAwBD;;AACD,MAAG/B,KAAK,CAACoC,OAAN,CAAcL,IAAd,CAAH,EAAwB;AACtB,WAAO,OAAP;AACD;;AACD,SAAO,SAAP;AACD;;AAED,IAAIf,mBAAmB,GAAG;AACxB,aAAU,EADc;AAExB,aAAU,EAFc;AAGxB,UAAO,EAHiB;AAIxB,WAAQ,EAJgB;AAKxB,WAAQ,EALgB;AAMxB,WAAQ,EANgB;AAOxB,YAAS,EAPe;AAQxB,YAAS,EARe;AASxB,WAAQ,EATgB;AAUxB,mBAAgB,EAVQ;AAWxB,cAAY,EAXY;AAYxB,eAAa,EAZW;AAaxB,YAAS,EAbe;AAcxB,aAAU;AAdc,CAA1B;;AAiBC,CAAC,YAAW;AACX,OAAI,IAAIqB,EAAR,IAAcrB,mBAAd,EAAmC;AACjCA,IAAAA,mBAAmB,CAACqB,EAAD,CAAnB,CAAwBd,IAAxB,CAA6BhB,kBAAkB,CAAC8B,EAAD,EAAK,CAAC,CAAN,CAA/C;AACD;AACF,CAJA;;AAMD,SAASC,kBAAT,CAA4BP,IAA5B,EAAkCQ,KAAlC,EAAyCzC,MAAzC,EAAiD0C,MAAjD,EAAyD;AACvD,MAAGT,IAAI,KAAKU,SAAZ,EAAuB;AACrB,QAAIC,IAAI,GAAG1B,mBAAmB,CAAC2B,KAApB,CAA0B,CAA1B,CAAX;AACA,WAAOD,IAAI,CAAC,EAAD,CAAX;AACD,GAHD,MAGO,IAAG,OAAOX,IAAP,KAAgB,QAAnB,EAA6B;AAClCA,IAAAA,IAAI,GAAG,CAACA,IAAD,CAAP;AACD;;AACD,MAAGQ,KAAK,KAAKE,SAAb,EAAwB;AACtBF,IAAAA,KAAK,GAAG,CAAER,IAAI,CAAC9B,MAAP,CAAR;AACD;;AACD,MAAI2C,CAAC,GAAGL,KAAK,CAACtC,MAAd;;AACA,MAAGH,MAAM,KAAK2C,SAAd,EAAyB;AACvB3C,IAAAA,MAAM,GAAG,IAAIE,KAAJ,CAAU4C,CAAV,CAAT;;AACA,SAAI,IAAI1C,CAAC,GAAC0C,CAAC,GAAC,CAAR,EAAWC,EAAE,GAAC,CAAlB,EAAqB3C,CAAC,IAAE,CAAxB,EAA2B,EAAEA,CAA7B,EAAgC;AAC9BJ,MAAAA,MAAM,CAACI,CAAD,CAAN,GAAY2C,EAAZ;AACAA,MAAAA,EAAE,IAAIN,KAAK,CAACrC,CAAD,CAAX;AACD;AACF;;AACD,MAAGsC,MAAM,KAAKC,SAAd,EAAyB;AACvBD,IAAAA,MAAM,GAAG,CAAT;;AACA,SAAI,IAAItC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC0C,CAAf,EAAkB,EAAE1C,CAApB,EAAuB;AACrB,UAAGJ,MAAM,CAACI,CAAD,CAAN,GAAY,CAAf,EAAkB;AAChBsC,QAAAA,MAAM,IAAI,CAACD,KAAK,CAACrC,CAAD,CAAL,GAAS,CAAV,IAAaJ,MAAM,CAACI,CAAD,CAA7B;AACD;AACF;AACF;;AACD,MAAIM,KAAK,GAAGsB,UAAU,CAACC,IAAD,CAAtB;AACA,MAAIe,SAAS,GAAG9B,mBAAmB,CAACR,KAAD,CAAnC;;AACA,SAAMsC,SAAS,CAAC7C,MAAV,IAAoB2C,CAAC,GAAC,CAA5B,EAA+B;AAC7BE,IAAAA,SAAS,CAACvB,IAAV,CAAehB,kBAAkB,CAACC,KAAD,EAAQsC,SAAS,CAAC7C,MAAV,GAAiB,CAAzB,CAAjC;AACD;;AACD,MAAIyC,IAAI,GAAGI,SAAS,CAACF,CAAC,GAAC,CAAH,CAApB;AACA,SAAOF,IAAI,CAACX,IAAD,EAAOQ,KAAP,EAAczC,MAAd,EAAsB0C,MAAtB,CAAX;AACD;;AAEDO,MAAM,CAACC,OAAP,GAAiBV,kBAAjB","sourcesContent":["var iota = require(\"iota-array\")\nvar isBuffer = require(\"is-buffer\")\n\nvar hasTypedArrays  = ((typeof Float64Array) !== \"undefined\")\n\nfunction compare1st(a, b) {\n  return a[0] - b[0]\n}\n\nfunction order() {\n  var stride = this.stride\n  var terms = new Array(stride.length)\n  var i\n  for(i=0; i<terms.length; ++i) {\n    terms[i] = [Math.abs(stride[i]), i]\n  }\n  terms.sort(compare1st)\n  var result = new Array(terms.length)\n  for(i=0; i<result.length; ++i) {\n    result[i] = terms[i][1]\n  }\n  return result\n}\n\nfunction compileConstructor(dtype, dimension) {\n  var className = [\"View\", dimension, \"d\", dtype].join(\"\")\n  if(dimension < 0) {\n    className = \"View_Nil\" + dtype\n  }\n  var useGetters = (dtype === \"generic\")\n\n  if(dimension === -1) {\n    //Special case for trivial arrays\n    var code =\n      \"function \"+className+\"(a){this.data=a;};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return -1};\\\nproto.size=0;\\\nproto.dimension=-1;\\\nproto.shape=proto.stride=proto.order=[];\\\nproto.lo=proto.hi=proto.transpose=proto.step=\\\nfunction(){return new \"+className+\"(this.data);};\\\nproto.get=proto.set=function(){};\\\nproto.pick=function(){return null};\\\nreturn function construct_\"+className+\"(a){return new \"+className+\"(a);}\"\n    var procedure = new Function(code)\n    return procedure()\n  } else if(dimension === 0) {\n    //Special case for 0d arrays\n    var code =\n      \"function \"+className+\"(a,d) {\\\nthis.data = a;\\\nthis.offset = d\\\n};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return this.offset};\\\nproto.dimension=0;\\\nproto.size=1;\\\nproto.shape=\\\nproto.stride=\\\nproto.order=[];\\\nproto.lo=\\\nproto.hi=\\\nproto.transpose=\\\nproto.step=function \"+className+\"_copy() {\\\nreturn new \"+className+\"(this.data,this.offset)\\\n};\\\nproto.pick=function \"+className+\"_pick(){\\\nreturn TrivialArray(this.data);\\\n};\\\nproto.valueOf=proto.get=function \"+className+\"_get(){\\\nreturn \"+(useGetters ? \"this.data.get(this.offset)\" : \"this.data[this.offset]\")+\n\"};\\\nproto.set=function \"+className+\"_set(v){\\\nreturn \"+(useGetters ? \"this.data.set(this.offset,v)\" : \"this.data[this.offset]=v\")+\"\\\n};\\\nreturn function construct_\"+className+\"(a,b,c,d){return new \"+className+\"(a,d)}\"\n    var procedure = new Function(\"TrivialArray\", code)\n    return procedure(CACHED_CONSTRUCTORS[dtype][0])\n  }\n\n  var code = [\"'use strict'\"]\n\n  //Create constructor for view\n  var indices = iota(dimension)\n  var args = indices.map(function(i) { return \"i\"+i })\n  var index_str = \"this.offset+\" + indices.map(function(i) {\n        return \"this.stride[\" + i + \"]*i\" + i\n      }).join(\"+\")\n  var shapeArg = indices.map(function(i) {\n      return \"b\"+i\n    }).join(\",\")\n  var strideArg = indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")\n  code.push(\n    \"function \"+className+\"(a,\" + shapeArg + \",\" + strideArg + \",d){this.data=a\",\n      \"this.shape=[\" + shapeArg + \"]\",\n      \"this.stride=[\" + strideArg + \"]\",\n      \"this.offset=d|0}\",\n    \"var proto=\"+className+\".prototype\",\n    \"proto.dtype='\"+dtype+\"'\",\n    \"proto.dimension=\"+dimension)\n\n  //view.size:\n  code.push(\"Object.defineProperty(proto,'size',{get:function \"+className+\"_size(){\\\nreturn \"+indices.map(function(i) { return \"this.shape[\"+i+\"]\" }).join(\"*\"),\n\"}})\")\n\n  //view.order:\n  if(dimension === 1) {\n    code.push(\"proto.order=[0]\")\n  } else {\n    code.push(\"Object.defineProperty(proto,'order',{get:\")\n    if(dimension < 4) {\n      code.push(\"function \"+className+\"_order(){\")\n      if(dimension === 2) {\n        code.push(\"return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})\")\n      } else if(dimension === 3) {\n        code.push(\n\"var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\\\nif(s0>s1){\\\nif(s1>s2){\\\nreturn [2,1,0];\\\n}else if(s0>s2){\\\nreturn [1,2,0];\\\n}else{\\\nreturn [1,0,2];\\\n}\\\n}else if(s0>s2){\\\nreturn [2,0,1];\\\n}else if(s2>s1){\\\nreturn [0,1,2];\\\n}else{\\\nreturn [0,2,1];\\\n}}})\")\n      }\n    } else {\n      code.push(\"ORDER})\")\n    }\n  }\n\n  //view.set(i0, ..., v):\n  code.push(\n\"proto.set=function \"+className+\"_set(\"+args.join(\",\")+\",v){\")\n  if(useGetters) {\n    code.push(\"return this.data.set(\"+index_str+\",v)}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]=v}\")\n  }\n\n  //view.get(i0, ...):\n  code.push(\"proto.get=function \"+className+\"_get(\"+args.join(\",\")+\"){\")\n  if(useGetters) {\n    code.push(\"return this.data.get(\"+index_str+\")}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]}\")\n  }\n\n  //view.index:\n  code.push(\n    \"proto.index=function \"+className+\"_index(\", args.join(), \"){return \"+index_str+\"}\")\n\n  //view.hi():\n  code.push(\"proto.hi=function \"+className+\"_hi(\"+args.join(\",\")+\"){return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return [\"(typeof i\",i,\"!=='number'||i\",i,\"<0)?this.shape[\", i, \"]:i\", i,\"|0\"].join(\"\")\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"this.stride[\"+i + \"]\"\n    }).join(\",\")+\",this.offset)}\")\n\n  //view.lo():\n  var a_vars = indices.map(function(i) { return \"a\"+i+\"=this.shape[\"+i+\"]\" })\n  var c_vars = indices.map(function(i) { return \"c\"+i+\"=this.stride[\"+i+\"]\" })\n  code.push(\"proto.lo=function \"+className+\"_lo(\"+args.join(\",\")+\"){var b=this.offset,d=0,\"+a_vars.join(\",\")+\",\"+c_vars.join(\",\"))\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){\\\nd=i\"+i+\"|0;\\\nb+=c\"+i+\"*d;\\\na\"+i+\"-=d}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\"+i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")+\",b)}\")\n\n  //view.step():\n  code.push(\"proto.step=function \"+className+\"_step(\"+args.join(\",\")+\"){var \"+\n    indices.map(function(i) {\n      return \"a\"+i+\"=this.shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\"+i+\"=this.stride[\"+i+\"]\"\n    }).join(\",\")+\",c=this.offset,d=0,ceil=Math.ceil\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'){\\\nd=i\"+i+\"|0;\\\nif(d<0){\\\nc+=b\"+i+\"*(a\"+i+\"-1);\\\na\"+i+\"=ceil(-a\"+i+\"/d)\\\n}else{\\\na\"+i+\"=ceil(a\"+i+\"/d)\\\n}\\\nb\"+i+\"*=d\\\n}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\" + i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\" + i\n    }).join(\",\")+\",c)}\")\n\n  //view.transpose():\n  var tShape = new Array(dimension)\n  var tStride = new Array(dimension)\n  for(var i=0; i<dimension; ++i) {\n    tShape[i] = \"a[i\"+i+\"]\"\n    tStride[i] = \"b[i\"+i+\"]\"\n  }\n  code.push(\"proto.transpose=function \"+className+\"_transpose(\"+args+\"){\"+\n    args.map(function(n,idx) { return n + \"=(\" + n + \"===undefined?\" + idx + \":\" + n + \"|0)\"}).join(\";\"),\n    \"var a=this.shape,b=this.stride;return new \"+className+\"(this.data,\"+tShape.join(\",\")+\",\"+tStride.join(\",\")+\",this.offset)}\")\n\n  //view.pick():\n  code.push(\"proto.pick=function \"+className+\"_pick(\"+args+\"){var a=[],b=[],c=this.offset\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){c=(c+this.stride[\"+i+\"]*i\"+i+\")|0}else{a.push(this.shape[\"+i+\"]);b.push(this.stride[\"+i+\"])}\")\n  }\n  code.push(\"var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}\")\n\n  //Add return statement\n  code.push(\"return function construct_\"+className+\"(data,shape,stride,offset){return new \"+className+\"(data,\"+\n    indices.map(function(i) {\n      return \"shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"stride[\"+i+\"]\"\n    }).join(\",\")+\",offset)}\")\n\n  //Compile procedure\n  var procedure = new Function(\"CTOR_LIST\", \"ORDER\", code.join(\"\\n\"))\n  return procedure(CACHED_CONSTRUCTORS[dtype], order)\n}\n\nfunction arrayDType(data) {\n  if(isBuffer(data)) {\n    return \"buffer\"\n  }\n  if(hasTypedArrays) {\n    switch(Object.prototype.toString.call(data)) {\n      case \"[object Float64Array]\":\n        return \"float64\"\n      case \"[object Float32Array]\":\n        return \"float32\"\n      case \"[object Int8Array]\":\n        return \"int8\"\n      case \"[object Int16Array]\":\n        return \"int16\"\n      case \"[object Int32Array]\":\n        return \"int32\"\n      case \"[object Uint8Array]\":\n        return \"uint8\"\n      case \"[object Uint16Array]\":\n        return \"uint16\"\n      case \"[object Uint32Array]\":\n        return \"uint32\"\n      case \"[object Uint8ClampedArray]\":\n        return \"uint8_clamped\"\n      case \"[object BigInt64Array]\":\n        return \"bigint64\"\n      case \"[object BigUint64Array]\":\n        return \"biguint64\"\n    }\n  }\n  if(Array.isArray(data)) {\n    return \"array\"\n  }\n  return \"generic\"\n}\n\nvar CACHED_CONSTRUCTORS = {\n  \"float32\":[],\n  \"float64\":[],\n  \"int8\":[],\n  \"int16\":[],\n  \"int32\":[],\n  \"uint8\":[],\n  \"uint16\":[],\n  \"uint32\":[],\n  \"array\":[],\n  \"uint8_clamped\":[],\n  \"bigint64\": [],\n  \"biguint64\": [],\n  \"buffer\":[],\n  \"generic\":[]\n}\n\n;(function() {\n  for(var id in CACHED_CONSTRUCTORS) {\n    CACHED_CONSTRUCTORS[id].push(compileConstructor(id, -1))\n  }\n});\n\nfunction wrappedNDArrayCtor(data, shape, stride, offset) {\n  if(data === undefined) {\n    var ctor = CACHED_CONSTRUCTORS.array[0]\n    return ctor([])\n  } else if(typeof data === \"number\") {\n    data = [data]\n  }\n  if(shape === undefined) {\n    shape = [ data.length ]\n  }\n  var d = shape.length\n  if(stride === undefined) {\n    stride = new Array(d)\n    for(var i=d-1, sz=1; i>=0; --i) {\n      stride[i] = sz\n      sz *= shape[i]\n    }\n  }\n  if(offset === undefined) {\n    offset = 0\n    for(var i=0; i<d; ++i) {\n      if(stride[i] < 0) {\n        offset -= (shape[i]-1)*stride[i]\n      }\n    }\n  }\n  var dtype = arrayDType(data)\n  var ctor_list = CACHED_CONSTRUCTORS[dtype]\n  while(ctor_list.length <= d+1) {\n    ctor_list.push(compileConstructor(dtype, ctor_list.length-1))\n  }\n  var ctor = ctor_list[d+1]\n  return ctor(data, shape, stride, offset)\n}\n\nmodule.exports = wrappedNDArrayCtor\n"]},"metadata":{},"sourceType":"script"}