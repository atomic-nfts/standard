{"ast":null,"code":"'use strict';\n\nvar util = require('util');\n\nvar Stream = require('stream');\n\nvar constants = require('./constants');\n\nvar Packer = require('./packer');\n\nvar PackerAsync = module.exports = function (opt) {\n  Stream.call(this);\n  var options = opt || {};\n  this._packer = new Packer(options);\n  this._deflate = this._packer.createDeflate();\n  this.readable = true;\n};\n\nutil.inherits(PackerAsync, Stream);\n\nPackerAsync.prototype.pack = function (data, width, height, gamma) {\n  // Signature\n  this.emit('data', new Buffer(constants.PNG_SIGNATURE));\n  this.emit('data', this._packer.packIHDR(width, height));\n\n  if (gamma) {\n    this.emit('data', this._packer.packGAMA(gamma));\n  }\n\n  var filteredData = this._packer.filterData(data, width, height); // compress it\n\n\n  this._deflate.on('error', this.emit.bind(this, 'error'));\n\n  this._deflate.on('data', function (compressedData) {\n    this.emit('data', this._packer.packIDAT(compressedData));\n  }.bind(this));\n\n  this._deflate.on('end', function () {\n    this.emit('data', this._packer.packIEND());\n    this.emit('end');\n  }.bind(this));\n\n  this._deflate.end(filteredData);\n};","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/pngjs-nozlib/lib/packer-async.js"],"names":["util","require","Stream","constants","Packer","PackerAsync","module","exports","opt","call","options","_packer","_deflate","createDeflate","readable","inherits","prototype","pack","data","width","height","gamma","emit","Buffer","PNG_SIGNATURE","packIHDR","packGAMA","filteredData","filterData","on","bind","compressedData","packIDAT","packIEND","end"],"mappings":"AAAA;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIE,SAAS,GAAGF,OAAO,CAAC,aAAD,CAAvB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAApB;;AAEA,IAAII,WAAW,GAAGC,MAAM,CAACC,OAAP,GAAiB,UAASC,GAAT,EAAc;AAC/CN,EAAAA,MAAM,CAACO,IAAP,CAAY,IAAZ;AAEA,MAAIC,OAAO,GAAGF,GAAG,IAAI,EAArB;AAEA,OAAKG,OAAL,GAAe,IAAIP,MAAJ,CAAWM,OAAX,CAAf;AACA,OAAKE,QAAL,GAAgB,KAAKD,OAAL,CAAaE,aAAb,EAAhB;AAEA,OAAKC,QAAL,GAAgB,IAAhB;AACD,CATD;;AAUAd,IAAI,CAACe,QAAL,CAAcV,WAAd,EAA2BH,MAA3B;;AAGAG,WAAW,CAACW,SAAZ,CAAsBC,IAAtB,GAA6B,UAASC,IAAT,EAAeC,KAAf,EAAsBC,MAAtB,EAA8BC,KAA9B,EAAqC;AAChE;AACA,OAAKC,IAAL,CAAU,MAAV,EAAkB,IAAIC,MAAJ,CAAWpB,SAAS,CAACqB,aAArB,CAAlB;AACA,OAAKF,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAac,QAAb,CAAsBN,KAAtB,EAA6BC,MAA7B,CAAlB;;AAEA,MAAIC,KAAJ,EAAW;AACT,SAAKC,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAae,QAAb,CAAsBL,KAAtB,CAAlB;AACD;;AAED,MAAIM,YAAY,GAAG,KAAKhB,OAAL,CAAaiB,UAAb,CAAwBV,IAAxB,EAA8BC,KAA9B,EAAqCC,MAArC,CAAnB,CATgE,CAWhE;;;AACA,OAAKR,QAAL,CAAciB,EAAd,CAAiB,OAAjB,EAA0B,KAAKP,IAAL,CAAUQ,IAAV,CAAe,IAAf,EAAqB,OAArB,CAA1B;;AAEA,OAAKlB,QAAL,CAAciB,EAAd,CAAiB,MAAjB,EAAyB,UAASE,cAAT,EAAyB;AAChD,SAAKT,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAaqB,QAAb,CAAsBD,cAAtB,CAAlB;AACD,GAFwB,CAEvBD,IAFuB,CAElB,IAFkB,CAAzB;;AAIA,OAAKlB,QAAL,CAAciB,EAAd,CAAiB,KAAjB,EAAwB,YAAW;AACjC,SAAKP,IAAL,CAAU,MAAV,EAAkB,KAAKX,OAAL,CAAasB,QAAb,EAAlB;AACA,SAAKX,IAAL,CAAU,KAAV;AACD,GAHuB,CAGtBQ,IAHsB,CAGjB,IAHiB,CAAxB;;AAKA,OAAKlB,QAAL,CAAcsB,GAAd,CAAkBP,YAAlB;AACD,CAxBD","sourcesContent":["'use strict';\n\nvar util = require('util');\nvar Stream = require('stream');\nvar constants = require('./constants');\nvar Packer = require('./packer');\n\nvar PackerAsync = module.exports = function(opt) {\n  Stream.call(this);\n\n  var options = opt || {};\n\n  this._packer = new Packer(options);\n  this._deflate = this._packer.createDeflate();\n\n  this.readable = true;\n};\nutil.inherits(PackerAsync, Stream);\n\n\nPackerAsync.prototype.pack = function(data, width, height, gamma) {\n  // Signature\n  this.emit('data', new Buffer(constants.PNG_SIGNATURE));\n  this.emit('data', this._packer.packIHDR(width, height));\n\n  if (gamma) {\n    this.emit('data', this._packer.packGAMA(gamma));\n  }\n\n  var filteredData = this._packer.filterData(data, width, height);\n\n  // compress it\n  this._deflate.on('error', this.emit.bind(this, 'error'));\n\n  this._deflate.on('data', function(compressedData) {\n    this.emit('data', this._packer.packIDAT(compressedData));\n  }.bind(this));\n\n  this._deflate.on('end', function() {\n    this.emit('data', this._packer.packIEND());\n    this.emit('end');\n  }.bind(this));\n\n  this._deflate.end(filteredData);\n};\n"]},"metadata":{},"sourceType":"script"}