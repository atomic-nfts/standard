{"ast":null,"code":"'use strict';\n\nvar util = require('util');\n\nvar Stream = require('stream');\n\nvar Parser = require('./parser-async');\n\nvar Packer = require('./packer-async');\n\nvar PNGSync = require('./png-sync');\n\nvar PNG = exports.PNG = function (options) {\n  Stream.call(this);\n  options = options || {}; // eslint-disable-line no-param-reassign\n\n  this.width = options.width || 0;\n  this.height = options.height || 0;\n  this.data = this.width > 0 && this.height > 0 ? new Buffer(4 * this.width * this.height) : null;\n\n  if (options.fill && this.data) {\n    this.data.fill(0);\n  }\n\n  this.gamma = 0;\n  this.readable = this.writable = true;\n  this._parser = new Parser(options);\n\n  this._parser.on('error', this.emit.bind(this, 'error'));\n\n  this._parser.on('close', this._handleClose.bind(this));\n\n  this._parser.on('metadata', this._metadata.bind(this));\n\n  this._parser.on('gamma', this._gamma.bind(this));\n\n  this._parser.on('parsed', function (data) {\n    this.data = data;\n    this.emit('parsed', data);\n  }.bind(this));\n\n  this._packer = new Packer(options);\n\n  this._packer.on('data', this.emit.bind(this, 'data'));\n\n  this._packer.on('end', this.emit.bind(this, 'end'));\n\n  this._parser.on('close', this._handleClose.bind(this));\n\n  this._packer.on('error', this.emit.bind(this, 'error'));\n};\n\nutil.inherits(PNG, Stream);\nPNG.sync = PNGSync;\n\nPNG.prototype.pack = function () {\n  if (!this.data || !this.data.length) {\n    this.emit('error', 'No data provided');\n    return this;\n  }\n\n  process.nextTick(function () {\n    this._packer.pack(this.data, this.width, this.height, this.gamma);\n  }.bind(this));\n  return this;\n};\n\nPNG.prototype.parse = function (data, callback) {\n  if (callback) {\n    var onParsed, onError;\n\n    onParsed = function (parsedData) {\n      this.removeListener('error', onError);\n      this.data = parsedData;\n      callback(null, this);\n    }.bind(this);\n\n    onError = function (err) {\n      this.removeListener('parsed', onParsed);\n      callback(err, null);\n    }.bind(this);\n\n    this.once('parsed', onParsed);\n    this.once('error', onError);\n  }\n\n  this.end(data);\n  return this;\n};\n\nPNG.prototype.write = function (data) {\n  this._parser.write(data);\n\n  return true;\n};\n\nPNG.prototype.end = function (data) {\n  this._parser.end(data);\n};\n\nPNG.prototype._metadata = function (metadata) {\n  this.width = metadata.width;\n  this.height = metadata.height;\n  this.emit('metadata', metadata);\n};\n\nPNG.prototype._gamma = function (gamma) {\n  this.gamma = gamma;\n};\n\nPNG.prototype._handleClose = function () {\n  if (!this._parser.writable && !this._packer.readable) {\n    this.emit('close');\n  }\n};\n\nPNG.bitblt = function (src, dst, srcX, srcY, width, height, deltaX, deltaY) {\n  // eslint-disable-line max-params\n  if (srcX > src.width || srcY > src.height || srcX + width > src.width || srcY + height > src.height) {\n    throw new Error('bitblt reading outside image');\n  }\n\n  if (deltaX > dst.width || deltaY > dst.height || deltaX + width > dst.width || deltaY + height > dst.height) {\n    throw new Error('bitblt writing outside image');\n  }\n\n  for (var y = 0; y < height; y++) {\n    src.data.copy(dst.data, (deltaY + y) * dst.width + deltaX << 2, (srcY + y) * src.width + srcX << 2, (srcY + y) * src.width + srcX + width << 2);\n  }\n};\n\nPNG.prototype.bitblt = function (dst, srcX, srcY, width, height, deltaX, deltaY) {\n  // eslint-disable-line max-params\n  PNG.bitblt(this, dst, srcX, srcY, width, height, deltaX, deltaY);\n  return this;\n};\n\nPNG.adjustGamma = function (src) {\n  if (src.gamma) {\n    for (var y = 0; y < src.height; y++) {\n      for (var x = 0; x < src.width; x++) {\n        var idx = src.width * y + x << 2;\n\n        for (var i = 0; i < 3; i++) {\n          var sample = src.data[idx + i] / 255;\n          sample = Math.pow(sample, 1 / 2.2 / src.gamma);\n          src.data[idx + i] = Math.round(sample * 255);\n        }\n      }\n    }\n\n    src.gamma = 0;\n  }\n};\n\nPNG.prototype.adjustGamma = function () {\n  PNG.adjustGamma(this);\n};","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/pngjs-nozlib/lib/png.js"],"names":["util","require","Stream","Parser","Packer","PNGSync","PNG","exports","options","call","width","height","data","Buffer","fill","gamma","readable","writable","_parser","on","emit","bind","_handleClose","_metadata","_gamma","_packer","inherits","sync","prototype","pack","length","process","nextTick","parse","callback","onParsed","onError","parsedData","removeListener","err","once","end","write","metadata","bitblt","src","dst","srcX","srcY","deltaX","deltaY","Error","y","copy","adjustGamma","x","idx","i","sample","Math","pow","round"],"mappings":"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","sourcesContent":["'use strict';\n\nvar util = require('util');\nvar Stream = require('stream');\nvar Parser = require('./parser-async');\nvar Packer = require('./packer-async');\nvar PNGSync = require('./png-sync');\n\n\nvar PNG = exports.PNG = function(options) {\n  Stream.call(this);\n\n  options = options || {}; // eslint-disable-line no-param-reassign\n\n  this.width = options.width || 0;\n  this.height = options.height || 0;\n\n  this.data = this.width > 0 && this.height > 0 ?\n    new Buffer(4 * this.width * this.height) : null;\n\n  if (options.fill && this.data) {\n    this.data.fill(0);\n  }\n\n  this.gamma = 0;\n  this.readable = this.writable = true;\n\n  this._parser = new Parser(options);\n\n  this._parser.on('error', this.emit.bind(this, 'error'));\n  this._parser.on('close', this._handleClose.bind(this));\n  this._parser.on('metadata', this._metadata.bind(this));\n  this._parser.on('gamma', this._gamma.bind(this));\n  this._parser.on('parsed', function(data) {\n    this.data = data;\n    this.emit('parsed', data);\n  }.bind(this));\n\n  this._packer = new Packer(options);\n  this._packer.on('data', this.emit.bind(this, 'data'));\n  this._packer.on('end', this.emit.bind(this, 'end'));\n  this._parser.on('close', this._handleClose.bind(this));\n  this._packer.on('error', this.emit.bind(this, 'error'));\n\n};\nutil.inherits(PNG, Stream);\n\nPNG.sync = PNGSync;\n\nPNG.prototype.pack = function() {\n\n  if (!this.data || !this.data.length) {\n    this.emit('error', 'No data provided');\n    return this;\n  }\n\n  process.nextTick(function() {\n    this._packer.pack(this.data, this.width, this.height, this.gamma);\n  }.bind(this));\n\n  return this;\n};\n\n\nPNG.prototype.parse = function(data, callback) {\n\n  if (callback) {\n    var onParsed, onError;\n\n    onParsed = function(parsedData) {\n      this.removeListener('error', onError);\n\n      this.data = parsedData;\n      callback(null, this);\n    }.bind(this);\n\n    onError = function(err) {\n      this.removeListener('parsed', onParsed);\n\n      callback(err, null);\n    }.bind(this);\n\n    this.once('parsed', onParsed);\n    this.once('error', onError);\n  }\n\n  this.end(data);\n  return this;\n};\n\nPNG.prototype.write = function(data) {\n  this._parser.write(data);\n  return true;\n};\n\nPNG.prototype.end = function(data) {\n  this._parser.end(data);\n};\n\nPNG.prototype._metadata = function(metadata) {\n  this.width = metadata.width;\n  this.height = metadata.height;\n\n  this.emit('metadata', metadata);\n};\n\nPNG.prototype._gamma = function(gamma) {\n  this.gamma = gamma;\n};\n\nPNG.prototype._handleClose = function() {\n  if (!this._parser.writable && !this._packer.readable) {\n    this.emit('close');\n  }\n};\n\n\nPNG.bitblt = function(src, dst, srcX, srcY, width, height, deltaX, deltaY) { // eslint-disable-line max-params\n\n  if (srcX > src.width || srcY > src.height || srcX + width > src.width || srcY + height > src.height) {\n    throw new Error('bitblt reading outside image');\n  }\n\n  if (deltaX > dst.width || deltaY > dst.height || deltaX + width > dst.width || deltaY + height > dst.height) {\n    throw new Error('bitblt writing outside image');\n  }\n\n  for (var y = 0; y < height; y++) {\n    src.data.copy(dst.data,\n      ((deltaY + y) * dst.width + deltaX) << 2,\n      ((srcY + y) * src.width + srcX) << 2,\n      ((srcY + y) * src.width + srcX + width) << 2\n    );\n  }\n};\n\n\nPNG.prototype.bitblt = function(dst, srcX, srcY, width, height, deltaX, deltaY) { // eslint-disable-line max-params\n\n  PNG.bitblt(this, dst, srcX, srcY, width, height, deltaX, deltaY);\n  return this;\n};\n\nPNG.adjustGamma = function(src) {\n  if (src.gamma) {\n    for (var y = 0; y < src.height; y++) {\n      for (var x = 0; x < src.width; x++) {\n        var idx = (src.width * y + x) << 2;\n\n        for (var i = 0; i < 3; i++) {\n          var sample = src.data[idx + i] / 255;\n          sample = Math.pow(sample, 1 / 2.2 / src.gamma);\n          src.data[idx + i] = Math.round(sample * 255);\n        }\n      }\n    }\n    src.gamma = 0;\n  }\n};\n\nPNG.prototype.adjustGamma = function() {\n  PNG.adjustGamma(this);\n};\n"]},"metadata":{},"sourceType":"script"}