{"ast":null,"code":"var asn = require('asn1.js');\n\nvar factor = require('./factor');\n\nvar one = new asn.bignum(1);\n\nfunction urlize(base64) {\n  return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n\nfunction hex2b64url(str) {\n  return urlize(Buffer.from(str, 'hex').toString('base64'));\n}\n\nfunction fromPEM(data) {\n  var text = data.toString().split(/(\\r\\n|\\r|\\n)+/g);\n  text = text.filter(function (line) {\n    return line.trim().length !== 0;\n  });\n  text = text.slice(1, -1).join('');\n  return Buffer.from(text.replace(/[^\\w\\d\\+\\/=]+/g, ''), 'base64');\n}\n\nvar RSAPublicKey = asn.define('RSAPublicKey', function () {\n  this.seq().obj(this.key('n').int(), this.key('e').int());\n});\nvar AlgorithmIdentifier = asn.define('AlgorithmIdentifier', function () {\n  this.seq().obj(this.key('algorithm').objid(), this.key('parameters').optional().any());\n});\nvar PublicKeyInfo = asn.define('PublicKeyInfo', function () {\n  this.seq().obj(this.key('algorithm').use(AlgorithmIdentifier), this.key('publicKey').bitstr());\n});\nvar Version = asn.define('Version', function () {\n  this.int({\n    0: 'two-prime',\n    1: 'multi'\n  });\n});\nvar OtherPrimeInfos = asn.define('OtherPrimeInfos', function () {\n  this.seq().obj(this.key('ri').int(), this.key('di').int(), this.key('ti').int());\n});\nvar RSAPrivateKey = asn.define('RSAPrivateKey', function () {\n  this.seq().obj(this.key('version').use(Version), this.key('n').int(), this.key('e').int(), this.key('d').int(), this.key('p').int(), this.key('q').int(), this.key('dp').int(), this.key('dq').int(), this.key('qi').int(), this.key('other').optional().use(OtherPrimeInfos));\n});\nvar PrivateKeyInfo = asn.define('PrivateKeyInfo', function () {\n  this.seq().obj(this.key('version').use(Version), this.key('algorithm').use(AlgorithmIdentifier), this.key('privateKey').bitstr());\n});\nvar RSA_OID = '1.2.840.113549.1.1.1';\n\nfunction addExtras(obj, extras) {\n  extras = extras || {};\n  Object.keys(extras).forEach(function (key) {\n    obj[key] = extras[key];\n  });\n  return obj;\n}\n\nfunction pad(hex) {\n  return hex.length % 2 === 1 ? '0' + hex : hex;\n}\n\nfunction decodeRsaPublic(buffer, extras) {\n  var key = RSAPublicKey.decode(buffer, 'der');\n  var e = pad(key.e.toString(16));\n  var jwk = {\n    kty: 'RSA',\n    n: bn2base64url(key.n),\n    e: hex2b64url(e)\n  };\n  return addExtras(jwk, extras);\n}\n\nfunction decodeRsaPrivate(buffer, extras) {\n  var key = RSAPrivateKey.decode(buffer, 'der');\n  var e = pad(key.e.toString(16));\n  var jwk = {\n    kty: 'RSA',\n    n: bn2base64url(key.n),\n    e: hex2b64url(e),\n    d: bn2base64url(key.d),\n    p: bn2base64url(key.p),\n    q: bn2base64url(key.q),\n    dp: bn2base64url(key.dp),\n    dq: bn2base64url(key.dq),\n    qi: bn2base64url(key.qi)\n  };\n  return addExtras(jwk, extras);\n}\n\nfunction decodePublic(buffer, extras) {\n  var info = PublicKeyInfo.decode(buffer, 'der');\n  return decodeRsaPublic(info.publicKey.data, extras);\n}\n\nfunction decodePrivate(buffer, extras) {\n  var info = PrivateKeyInfo.decode(buffer, 'der');\n  return decodeRsaPrivate(info.privateKey.data, extras);\n}\n\nfunction getDecoder(header) {\n  var match = /^-----BEGIN (RSA )?(PUBLIC|PRIVATE) KEY-----$/.exec(header);\n\n  if (!match) {\n    return null;\n  }\n\n  var isRSA = !!match[1];\n  var isPrivate = match[2] === 'PRIVATE';\n\n  if (isPrivate) {\n    return isRSA ? decodeRsaPrivate : decodePrivate;\n  } else {\n    return isRSA ? decodeRsaPublic : decodePublic;\n  }\n}\n\nfunction pem2jwk(pem, extras) {\n  var text = pem.toString().split(/(\\r\\n|\\r|\\n)+/g);\n  text = text.filter(function (line) {\n    return line.trim().length !== 0;\n  });\n  var decoder = getDecoder(text[0]);\n  text = text.slice(1, -1).join('');\n  return decoder(Buffer.from(text.replace(/[^\\w\\d\\+\\/=]+/g, ''), 'base64'), extras);\n}\n\nfunction recomputePrimes(jwk) {\n  var pq = factor(jwk.e, jwk.d, jwk.n);\n  var p = pq.p;\n  var q = pq.q;\n  var dp = jwk.d.mod(p.sub(one));\n  var dq = jwk.d.mod(q.sub(one));\n  var qi = q.invm(p);\n  return {\n    n: jwk.n,\n    e: jwk.e,\n    d: jwk.d,\n    p: p,\n    q: q,\n    dp: dp,\n    dq: dq,\n    qi: qi\n  };\n}\n\nfunction parse(jwk) {\n  return {\n    n: string2bn(jwk.n),\n    e: string2bn(jwk.e),\n    d: jwk.d && string2bn(jwk.d),\n    p: jwk.p && string2bn(jwk.p),\n    q: jwk.q && string2bn(jwk.q),\n    dp: jwk.dp && string2bn(jwk.dp),\n    dq: jwk.dq && string2bn(jwk.dq),\n    qi: jwk.qi && string2bn(jwk.qi)\n  };\n}\n\nfunction jwk2pem(json) {\n  var jwk = parse(json);\n  var isPrivate = !!jwk.d;\n  var t = isPrivate ? 'PRIVATE' : 'PUBLIC';\n  var header = '-----BEGIN RSA ' + t + ' KEY-----\\n';\n  var footer = '\\n-----END RSA ' + t + ' KEY-----\\n';\n  var data = null;\n\n  if (isPrivate) {\n    if (!jwk.p) {\n      jwk = recomputePrimes(jwk);\n    }\n\n    jwk.version = 'two-prime';\n    data = RSAPrivateKey.encode(jwk, 'der');\n  } else {\n    data = RSAPublicKey.encode(jwk, 'der');\n  }\n\n  var body = data.toString('base64').match(/.{1,64}/g).join('\\n');\n  return header + body + footer;\n}\n\nfunction bn2base64url(bn) {\n  return hex2b64url(pad(bn.toString(16)));\n}\n\nfunction base64url2bn(str) {\n  return new asn.bignum(Buffer.from(str, 'base64'));\n}\n\nfunction string2bn(str) {\n  if (/^[0-9]+$/.test(str)) {\n    return new asn.bignum(str, 10);\n  }\n\n  return base64url2bn(str);\n}\n\nmodule.exports = {\n  pem2jwk: pem2jwk,\n  jwk2pem: jwk2pem,\n  BN: asn.bignum\n};","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/pem-jwk/index.js"],"names":["asn","require","factor","one","bignum","urlize","base64","replace","hex2b64url","str","Buffer","from","toString","fromPEM","data","text","split","filter","line","trim","length","slice","join","RSAPublicKey","define","seq","obj","key","int","AlgorithmIdentifier","objid","optional","any","PublicKeyInfo","use","bitstr","Version","OtherPrimeInfos","RSAPrivateKey","PrivateKeyInfo","RSA_OID","addExtras","extras","Object","keys","forEach","pad","hex","decodeRsaPublic","buffer","decode","e","jwk","kty","n","bn2base64url","decodeRsaPrivate","d","p","q","dp","dq","qi","decodePublic","info","publicKey","decodePrivate","privateKey","getDecoder","header","match","exec","isRSA","isPrivate","pem2jwk","pem","decoder","recomputePrimes","pq","mod","sub","invm","parse","string2bn","jwk2pem","json","t","footer","version","encode","body","bn","base64url2bn","test","module","exports","BN"],"mappings":"AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,SAAD,CAAjB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIE,GAAG,GAAG,IAAIH,GAAG,CAACI,MAAR,CAAe,CAAf,CAAV;;AAEA,SAASC,MAAT,CAAgBC,MAAhB,EAAwB;AACtB,SAAOA,MAAM,CAACC,OAAP,CAAe,KAAf,EAAsB,GAAtB,EACJA,OADI,CACI,KADJ,EACW,GADX,EAEJA,OAFI,CAEI,IAFJ,EAEU,EAFV,CAAP;AAGD;;AAED,SAASC,UAAT,CAAoBC,GAApB,EAAyB;AACvB,SAAOJ,MAAM,CAACK,MAAM,CAACC,IAAP,CAAYF,GAAZ,EAAiB,KAAjB,EAAwBG,QAAxB,CAAiC,QAAjC,CAAD,CAAb;AACD;;AAED,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AACrB,MAAIC,IAAI,GAAGD,IAAI,CAACF,QAAL,GAAgBI,KAAhB,CAAsB,gBAAtB,CAAX;AACAD,EAAAA,IAAI,GAAGA,IAAI,CAACE,MAAL,CAAY,UAASC,IAAT,EAAe;AAChC,WAAOA,IAAI,CAACC,IAAL,GAAYC,MAAZ,KAAuB,CAA9B;AACD,GAFM,CAAP;AAGAL,EAAAA,IAAI,GAAGA,IAAI,CAACM,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,EAAkBC,IAAlB,CAAuB,EAAvB,CAAP;AACA,SAAOZ,MAAM,CAACC,IAAP,CAAYI,IAAI,CAACR,OAAL,CAAa,gBAAb,EAA+B,EAA/B,CAAZ,EAAgD,QAAhD,CAAP;AACD;;AAED,IAAIgB,YAAY,GAAGvB,GAAG,CAACwB,MAAJ,CAAW,cAAX,EAA2B,YAAY;AACxD,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,GAAT,EAAcC,GAAd,EADF,EAEE,KAAKD,GAAL,CAAS,GAAT,EAAcC,GAAd,EAFF;AAID,CALkB,CAAnB;AAOA,IAAIC,mBAAmB,GAAG7B,GAAG,CAACwB,MAAJ,CAAW,qBAAX,EAAkC,YAAY;AACtE,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,WAAT,EAAsBG,KAAtB,EADF,EAEE,KAAKH,GAAL,CAAS,YAAT,EAAuBI,QAAvB,GAAkCC,GAAlC,EAFF;AAID,CALyB,CAA1B;AAOA,IAAIC,aAAa,GAAGjC,GAAG,CAACwB,MAAJ,CAAW,eAAX,EAA4B,YAAY;AAC1D,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,WAAT,EAAsBO,GAAtB,CAA0BL,mBAA1B,CADF,EAEE,KAAKF,GAAL,CAAS,WAAT,EAAsBQ,MAAtB,EAFF;AAID,CALmB,CAApB;AAOA,IAAIC,OAAO,GAAGpC,GAAG,CAACwB,MAAJ,CAAW,SAAX,EAAsB,YAAY;AAC9C,OAAKI,GAAL,CAAS;AACP,OAAG,WADI;AAEP,OAAG;AAFI,GAAT;AAID,CALa,CAAd;AAOA,IAAIS,eAAe,GAAGrC,GAAG,CAACwB,MAAJ,CAAW,iBAAX,EAA8B,YAAY;AAC9D,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,IAAT,EAAeC,GAAf,EADF,EAEE,KAAKD,GAAL,CAAS,IAAT,EAAeC,GAAf,EAFF,EAGE,KAAKD,GAAL,CAAS,IAAT,EAAeC,GAAf,EAHF;AAKD,CANqB,CAAtB;AAQA,IAAIU,aAAa,GAAGtC,GAAG,CAACwB,MAAJ,CAAW,eAAX,EAA4B,YAAY;AAC1D,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,SAAT,EAAoBO,GAApB,CAAwBE,OAAxB,CADF,EAEE,KAAKT,GAAL,CAAS,GAAT,EAAcC,GAAd,EAFF,EAGE,KAAKD,GAAL,CAAS,GAAT,EAAcC,GAAd,EAHF,EAIE,KAAKD,GAAL,CAAS,GAAT,EAAcC,GAAd,EAJF,EAKE,KAAKD,GAAL,CAAS,GAAT,EAAcC,GAAd,EALF,EAME,KAAKD,GAAL,CAAS,GAAT,EAAcC,GAAd,EANF,EAOE,KAAKD,GAAL,CAAS,IAAT,EAAeC,GAAf,EAPF,EAQE,KAAKD,GAAL,CAAS,IAAT,EAAeC,GAAf,EARF,EASE,KAAKD,GAAL,CAAS,IAAT,EAAeC,GAAf,EATF,EAUE,KAAKD,GAAL,CAAS,OAAT,EAAkBI,QAAlB,GAA6BG,GAA7B,CAAiCG,eAAjC,CAVF;AAYD,CAbmB,CAApB;AAeA,IAAIE,cAAc,GAAGvC,GAAG,CAACwB,MAAJ,CAAW,gBAAX,EAA6B,YAAY;AAC5D,OAAKC,GAAL,GAAWC,GAAX,CACE,KAAKC,GAAL,CAAS,SAAT,EAAoBO,GAApB,CAAwBE,OAAxB,CADF,EAEE,KAAKT,GAAL,CAAS,WAAT,EAAsBO,GAAtB,CAA0BL,mBAA1B,CAFF,EAGE,KAAKF,GAAL,CAAS,YAAT,EAAuBQ,MAAvB,EAHF;AAKD,CANoB,CAArB;AAQA,IAAMK,OAAO,GAAG,sBAAhB;;AAEA,SAASC,SAAT,CAAmBf,GAAnB,EAAwBgB,MAAxB,EAAgC;AAC9BA,EAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;AACAC,EAAAA,MAAM,CAACC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CACE,UAAUlB,GAAV,EAAe;AACbD,IAAAA,GAAG,CAACC,GAAD,CAAH,GAAWe,MAAM,CAACf,GAAD,CAAjB;AACD,GAHH;AAKA,SAAOD,GAAP;AACD;;AAED,SAASoB,GAAT,CAAaC,GAAb,EAAkB;AAChB,SAAQA,GAAG,CAAC3B,MAAJ,GAAa,CAAb,KAAmB,CAApB,GAAyB,MAAM2B,GAA/B,GAAqCA,GAA5C;AACD;;AAED,SAASC,eAAT,CAAyBC,MAAzB,EAAiCP,MAAjC,EAAyC;AACvC,MAAIf,GAAG,GAAGJ,YAAY,CAAC2B,MAAb,CAAoBD,MAApB,EAA4B,KAA5B,CAAV;AACA,MAAIE,CAAC,GAAGL,GAAG,CAACnB,GAAG,CAACwB,CAAJ,CAAMvC,QAAN,CAAe,EAAf,CAAD,CAAX;AACA,MAAIwC,GAAG,GAAG;AACRC,IAAAA,GAAG,EAAE,KADG;AAERC,IAAAA,CAAC,EAAEC,YAAY,CAAC5B,GAAG,CAAC2B,CAAL,CAFP;AAGRH,IAAAA,CAAC,EAAE3C,UAAU,CAAC2C,CAAD;AAHL,GAAV;AAKA,SAAOV,SAAS,CAACW,GAAD,EAAMV,MAAN,CAAhB;AACD;;AAED,SAASc,gBAAT,CAA0BP,MAA1B,EAAkCP,MAAlC,EAA0C;AACxC,MAAIf,GAAG,GAAGW,aAAa,CAACY,MAAd,CAAqBD,MAArB,EAA6B,KAA7B,CAAV;AACA,MAAIE,CAAC,GAAGL,GAAG,CAACnB,GAAG,CAACwB,CAAJ,CAAMvC,QAAN,CAAe,EAAf,CAAD,CAAX;AACA,MAAIwC,GAAG,GAAG;AACRC,IAAAA,GAAG,EAAE,KADG;AAERC,IAAAA,CAAC,EAAEC,YAAY,CAAC5B,GAAG,CAAC2B,CAAL,CAFP;AAGRH,IAAAA,CAAC,EAAE3C,UAAU,CAAC2C,CAAD,CAHL;AAIRM,IAAAA,CAAC,EAAEF,YAAY,CAAC5B,GAAG,CAAC8B,CAAL,CAJP;AAKRC,IAAAA,CAAC,EAAEH,YAAY,CAAC5B,GAAG,CAAC+B,CAAL,CALP;AAMRC,IAAAA,CAAC,EAAEJ,YAAY,CAAC5B,GAAG,CAACgC,CAAL,CANP;AAORC,IAAAA,EAAE,EAAEL,YAAY,CAAC5B,GAAG,CAACiC,EAAL,CAPR;AAQRC,IAAAA,EAAE,EAAEN,YAAY,CAAC5B,GAAG,CAACkC,EAAL,CARR;AASRC,IAAAA,EAAE,EAAEP,YAAY,CAAC5B,GAAG,CAACmC,EAAL;AATR,GAAV;AAWA,SAAOrB,SAAS,CAACW,GAAD,EAAMV,MAAN,CAAhB;AACD;;AAED,SAASqB,YAAT,CAAsBd,MAAtB,EAA8BP,MAA9B,EAAsC;AACpC,MAAIsB,IAAI,GAAG/B,aAAa,CAACiB,MAAd,CAAqBD,MAArB,EAA6B,KAA7B,CAAX;AACA,SAAOD,eAAe,CAACgB,IAAI,CAACC,SAAL,CAAenD,IAAhB,EAAsB4B,MAAtB,CAAtB;AACD;;AAED,SAASwB,aAAT,CAAuBjB,MAAvB,EAA+BP,MAA/B,EAAuC;AACrC,MAAIsB,IAAI,GAAGzB,cAAc,CAACW,MAAf,CAAsBD,MAAtB,EAA8B,KAA9B,CAAX;AACA,SAAOO,gBAAgB,CAACQ,IAAI,CAACG,UAAL,CAAgBrD,IAAjB,EAAuB4B,MAAvB,CAAvB;AACD;;AAED,SAAS0B,UAAT,CAAoBC,MAApB,EAA4B;AAC1B,MAAIC,KAAK,GAAG,gDAAgDC,IAAhD,CAAqDF,MAArD,CAAZ;;AACA,MAAI,CAACC,KAAL,EAAY;AAAE,WAAO,IAAP;AAAa;;AAC3B,MAAIE,KAAK,GAAG,CAAC,CAAEF,KAAK,CAAC,CAAD,CAApB;AACA,MAAIG,SAAS,GAAIH,KAAK,CAAC,CAAD,CAAL,KAAa,SAA9B;;AACA,MAAIG,SAAJ,EAAe;AACb,WAAOD,KAAK,GAAGhB,gBAAH,GAAsBU,aAAlC;AACD,GAFD,MAGK;AACH,WAAOM,KAAK,GAAGxB,eAAH,GAAqBe,YAAjC;AACD;AACF;;AAED,SAASW,OAAT,CAAiBC,GAAjB,EAAsBjC,MAAtB,EAA8B;AAC5B,MAAI3B,IAAI,GAAG4D,GAAG,CAAC/D,QAAJ,GAAeI,KAAf,CAAqB,gBAArB,CAAX;AACAD,EAAAA,IAAI,GAAGA,IAAI,CAACE,MAAL,CAAY,UAASC,IAAT,EAAe;AAChC,WAAOA,IAAI,CAACC,IAAL,GAAYC,MAAZ,KAAuB,CAA9B;AACD,GAFM,CAAP;AAGA,MAAIwD,OAAO,GAAGR,UAAU,CAACrD,IAAI,CAAC,CAAD,CAAL,CAAxB;AAEAA,EAAAA,IAAI,GAAGA,IAAI,CAACM,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,EAAkBC,IAAlB,CAAuB,EAAvB,CAAP;AACA,SAAOsD,OAAO,CAAClE,MAAM,CAACC,IAAP,CAAYI,IAAI,CAACR,OAAL,CAAa,gBAAb,EAA+B,EAA/B,CAAZ,EAAgD,QAAhD,CAAD,EAA4DmC,MAA5D,CAAd;AACD;;AAED,SAASmC,eAAT,CAAyBzB,GAAzB,EAA8B;AAC5B,MAAI0B,EAAE,GAAG5E,MAAM,CAACkD,GAAG,CAACD,CAAL,EAAQC,GAAG,CAACK,CAAZ,EAAeL,GAAG,CAACE,CAAnB,CAAf;AACA,MAAII,CAAC,GAAGoB,EAAE,CAACpB,CAAX;AACA,MAAIC,CAAC,GAAGmB,EAAE,CAACnB,CAAX;AACA,MAAIC,EAAE,GAAGR,GAAG,CAACK,CAAJ,CAAMsB,GAAN,CAAUrB,CAAC,CAACsB,GAAF,CAAM7E,GAAN,CAAV,CAAT;AACA,MAAI0D,EAAE,GAAGT,GAAG,CAACK,CAAJ,CAAMsB,GAAN,CAAUpB,CAAC,CAACqB,GAAF,CAAM7E,GAAN,CAAV,CAAT;AACA,MAAI2D,EAAE,GAAGH,CAAC,CAACsB,IAAF,CAAOvB,CAAP,CAAT;AACA,SAAO;AACLJ,IAAAA,CAAC,EAAEF,GAAG,CAACE,CADF;AAELH,IAAAA,CAAC,EAAEC,GAAG,CAACD,CAFF;AAGLM,IAAAA,CAAC,EAAEL,GAAG,CAACK,CAHF;AAILC,IAAAA,CAAC,EAAEA,CAJE;AAKLC,IAAAA,CAAC,EAAEA,CALE;AAMLC,IAAAA,EAAE,EAAEA,EANC;AAOLC,IAAAA,EAAE,EAAEA,EAPC;AAQLC,IAAAA,EAAE,EAAEA;AARC,GAAP;AAUD;;AAED,SAASoB,KAAT,CAAe9B,GAAf,EAAoB;AAClB,SAAO;AACLE,IAAAA,CAAC,EAAE6B,SAAS,CAAC/B,GAAG,CAACE,CAAL,CADP;AAELH,IAAAA,CAAC,EAAEgC,SAAS,CAAC/B,GAAG,CAACD,CAAL,CAFP;AAGLM,IAAAA,CAAC,EAAEL,GAAG,CAACK,CAAJ,IAAS0B,SAAS,CAAC/B,GAAG,CAACK,CAAL,CAHhB;AAILC,IAAAA,CAAC,EAAEN,GAAG,CAACM,CAAJ,IAASyB,SAAS,CAAC/B,GAAG,CAACM,CAAL,CAJhB;AAKLC,IAAAA,CAAC,EAAEP,GAAG,CAACO,CAAJ,IAASwB,SAAS,CAAC/B,GAAG,CAACO,CAAL,CALhB;AAMLC,IAAAA,EAAE,EAAER,GAAG,CAACQ,EAAJ,IAAUuB,SAAS,CAAC/B,GAAG,CAACQ,EAAL,CANlB;AAOLC,IAAAA,EAAE,EAAET,GAAG,CAACS,EAAJ,IAAUsB,SAAS,CAAC/B,GAAG,CAACS,EAAL,CAPlB;AAQLC,IAAAA,EAAE,EAAEV,GAAG,CAACU,EAAJ,IAAUqB,SAAS,CAAC/B,GAAG,CAACU,EAAL;AARlB,GAAP;AAUD;;AAED,SAASsB,OAAT,CAAiBC,IAAjB,EAAuB;AACrB,MAAIjC,GAAG,GAAG8B,KAAK,CAACG,IAAD,CAAf;AACA,MAAIZ,SAAS,GAAG,CAAC,CAAErB,GAAG,CAACK,CAAvB;AACA,MAAI6B,CAAC,GAAGb,SAAS,GAAG,SAAH,GAAe,QAAhC;AACA,MAAIJ,MAAM,GAAG,oBAAoBiB,CAApB,GAAwB,aAArC;AACA,MAAIC,MAAM,GAAG,oBAAoBD,CAApB,GAAwB,aAArC;AACA,MAAIxE,IAAI,GAAG,IAAX;;AACA,MAAI2D,SAAJ,EAAe;AACb,QAAI,CAACrB,GAAG,CAACM,CAAT,EAAY;AACVN,MAAAA,GAAG,GAAGyB,eAAe,CAACzB,GAAD,CAArB;AACD;;AACDA,IAAAA,GAAG,CAACoC,OAAJ,GAAc,WAAd;AACA1E,IAAAA,IAAI,GAAGwB,aAAa,CAACmD,MAAd,CAAqBrC,GAArB,EAA0B,KAA1B,CAAP;AACD,GAND,MAOK;AACHtC,IAAAA,IAAI,GAAGS,YAAY,CAACkE,MAAb,CAAoBrC,GAApB,EAAyB,KAAzB,CAAP;AACD;;AACD,MAAIsC,IAAI,GAAG5E,IAAI,CAACF,QAAL,CAAc,QAAd,EAAwB0D,KAAxB,CAA8B,UAA9B,EAA0ChD,IAA1C,CAA+C,IAA/C,CAAX;AACA,SAAO+C,MAAM,GAAGqB,IAAT,GAAgBH,MAAvB;AACD;;AAED,SAAShC,YAAT,CAAsBoC,EAAtB,EAA0B;AACxB,SAAOnF,UAAU,CAACsC,GAAG,CAAC6C,EAAE,CAAC/E,QAAH,CAAY,EAAZ,CAAD,CAAJ,CAAjB;AACD;;AAED,SAASgF,YAAT,CAAsBnF,GAAtB,EAA2B;AACzB,SAAO,IAAIT,GAAG,CAACI,MAAR,CAAeM,MAAM,CAACC,IAAP,CAAYF,GAAZ,EAAiB,QAAjB,CAAf,CAAP;AACD;;AAED,SAAS0E,SAAT,CAAmB1E,GAAnB,EAAwB;AACtB,MAAI,WAAWoF,IAAX,CAAgBpF,GAAhB,CAAJ,EAA0B;AACxB,WAAO,IAAIT,GAAG,CAACI,MAAR,CAAeK,GAAf,EAAoB,EAApB,CAAP;AACD;;AACD,SAAOmF,YAAY,CAACnF,GAAD,CAAnB;AACD;;AAEDqF,MAAM,CAACC,OAAP,GAAiB;AACfrB,EAAAA,OAAO,EAAEA,OADM;AAEfU,EAAAA,OAAO,EAAEA,OAFM;AAGfY,EAAAA,EAAE,EAAEhG,GAAG,CAACI;AAHO,CAAjB","sourcesContent":["var asn = require('asn1.js')\nvar factor = require('./factor')\nvar one = new asn.bignum(1)\n\nfunction urlize(base64) {\n  return base64.replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '')\n}\n\nfunction hex2b64url(str) {\n  return urlize(Buffer.from(str, 'hex').toString('base64'))\n}\n\nfunction fromPEM(data) {\n  var text = data.toString().split(/(\\r\\n|\\r|\\n)+/g);\n  text = text.filter(function(line) {\n    return line.trim().length !== 0;\n  });\n  text = text.slice(1, -1).join('');\n  return Buffer.from(text.replace(/[^\\w\\d\\+\\/=]+/g, ''), 'base64');\n}\n\nvar RSAPublicKey = asn.define('RSAPublicKey', function () {\n  this.seq().obj(\n    this.key('n').int(),\n    this.key('e').int()\n  )\n})\n\nvar AlgorithmIdentifier = asn.define('AlgorithmIdentifier', function () {\n  this.seq().obj(\n    this.key('algorithm').objid(),\n    this.key('parameters').optional().any()\n  )\n})\n\nvar PublicKeyInfo = asn.define('PublicKeyInfo', function () {\n  this.seq().obj(\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('publicKey').bitstr()\n  )\n})\n\nvar Version = asn.define('Version', function () {\n  this.int({\n    0: 'two-prime',\n    1: 'multi'\n  })\n})\n\nvar OtherPrimeInfos = asn.define('OtherPrimeInfos', function () {\n  this.seq().obj(\n    this.key('ri').int(),\n    this.key('di').int(),\n    this.key('ti').int()\n  )\n})\n\nvar RSAPrivateKey = asn.define('RSAPrivateKey', function () {\n  this.seq().obj(\n    this.key('version').use(Version),\n    this.key('n').int(),\n    this.key('e').int(),\n    this.key('d').int(),\n    this.key('p').int(),\n    this.key('q').int(),\n    this.key('dp').int(),\n    this.key('dq').int(),\n    this.key('qi').int(),\n    this.key('other').optional().use(OtherPrimeInfos)\n  )\n})\n\nvar PrivateKeyInfo = asn.define('PrivateKeyInfo', function () {\n  this.seq().obj(\n    this.key('version').use(Version),\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('privateKey').bitstr()\n  )\n})\n\nconst RSA_OID = '1.2.840.113549.1.1.1'\n\nfunction addExtras(obj, extras) {\n  extras = extras || {}\n  Object.keys(extras).forEach(\n    function (key) {\n      obj[key] = extras[key]\n    }\n  )\n  return obj\n}\n\nfunction pad(hex) {\n  return (hex.length % 2 === 1) ? '0' + hex : hex\n}\n\nfunction decodeRsaPublic(buffer, extras) {\n  var key = RSAPublicKey.decode(buffer, 'der')\n  var e = pad(key.e.toString(16))\n  var jwk = {\n    kty: 'RSA',\n    n: bn2base64url(key.n),\n    e: hex2b64url(e)\n  }\n  return addExtras(jwk, extras)\n}\n\nfunction decodeRsaPrivate(buffer, extras) {\n  var key = RSAPrivateKey.decode(buffer, 'der')\n  var e = pad(key.e.toString(16))\n  var jwk = {\n    kty: 'RSA',\n    n: bn2base64url(key.n),\n    e: hex2b64url(e),\n    d: bn2base64url(key.d),\n    p: bn2base64url(key.p),\n    q: bn2base64url(key.q),\n    dp: bn2base64url(key.dp),\n    dq: bn2base64url(key.dq),\n    qi: bn2base64url(key.qi)\n  }\n  return addExtras(jwk, extras)\n}\n\nfunction decodePublic(buffer, extras) {\n  var info = PublicKeyInfo.decode(buffer, 'der')\n  return decodeRsaPublic(info.publicKey.data, extras)\n}\n\nfunction decodePrivate(buffer, extras) {\n  var info = PrivateKeyInfo.decode(buffer, 'der')\n  return decodeRsaPrivate(info.privateKey.data, extras)\n}\n\nfunction getDecoder(header) {\n  var match = /^-----BEGIN (RSA )?(PUBLIC|PRIVATE) KEY-----$/.exec(header)\n  if (!match) { return null }\n  var isRSA = !!(match[1])\n  var isPrivate = (match[2] === 'PRIVATE')\n  if (isPrivate) {\n    return isRSA ? decodeRsaPrivate : decodePrivate\n  }\n  else {\n    return isRSA ? decodeRsaPublic : decodePublic\n  }\n}\n\nfunction pem2jwk(pem, extras) {\n  var text = pem.toString().split(/(\\r\\n|\\r|\\n)+/g)\n  text = text.filter(function(line) {\n    return line.trim().length !== 0\n  });\n  var decoder = getDecoder(text[0])\n\n  text = text.slice(1, -1).join('')\n  return decoder(Buffer.from(text.replace(/[^\\w\\d\\+\\/=]+/g, ''), 'base64'), extras)\n}\n\nfunction recomputePrimes(jwk) {\n  var pq = factor(jwk.e, jwk.d, jwk.n)\n  var p = pq.p\n  var q = pq.q\n  var dp = jwk.d.mod(p.sub(one))\n  var dq = jwk.d.mod(q.sub(one))\n  var qi = q.invm(p)\n  return {\n    n: jwk.n,\n    e: jwk.e,\n    d: jwk.d,\n    p: p,\n    q: q,\n    dp: dp,\n    dq: dq,\n    qi: qi\n  }\n}\n\nfunction parse(jwk) {\n  return {\n    n: string2bn(jwk.n),\n    e: string2bn(jwk.e),\n    d: jwk.d && string2bn(jwk.d),\n    p: jwk.p && string2bn(jwk.p),\n    q: jwk.q && string2bn(jwk.q),\n    dp: jwk.dp && string2bn(jwk.dp),\n    dq: jwk.dq && string2bn(jwk.dq),\n    qi: jwk.qi && string2bn(jwk.qi)\n  }\n}\n\nfunction jwk2pem(json) {\n  var jwk = parse(json)\n  var isPrivate = !!(jwk.d)\n  var t = isPrivate ? 'PRIVATE' : 'PUBLIC'\n  var header = '-----BEGIN RSA ' + t + ' KEY-----\\n'\n  var footer = '\\n-----END RSA ' + t + ' KEY-----\\n'\n  var data = null\n  if (isPrivate) {\n    if (!jwk.p) {\n      jwk = recomputePrimes(jwk)\n    }\n    jwk.version = 'two-prime'\n    data = RSAPrivateKey.encode(jwk, 'der')\n  }\n  else {\n    data = RSAPublicKey.encode(jwk, 'der')\n  }\n  var body = data.toString('base64').match(/.{1,64}/g).join('\\n')\n  return header + body + footer\n}\n\nfunction bn2base64url(bn) {\n  return hex2b64url(pad(bn.toString(16)))\n}\n\nfunction base64url2bn(str) {\n  return new asn.bignum(Buffer.from(str, 'base64'))\n}\n\nfunction string2bn(str) {\n  if (/^[0-9]+$/.test(str)) {\n    return new asn.bignum(str, 10)\n  }\n  return base64url2bn(str)\n}\n\nmodule.exports = {\n  pem2jwk: pem2jwk,\n  jwk2pem: jwk2pem,\n  BN: asn.bignum\n}\n"]},"metadata":{},"sourceType":"script"}