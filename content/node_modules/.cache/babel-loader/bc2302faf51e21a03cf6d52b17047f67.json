{"ast":null,"code":"'use strict';\n\nvar constants = require('./constants');\n\nvar CrcStream = require('./crc');\n\nvar bitPacker = require('./bitpacker');\n\nvar filter = require('./filter-pack');\n\nvar zlib = require('zlib');\n\nvar Packer = module.exports = function (options) {\n  this._options = options;\n  options.deflateChunkSize = options.deflateChunkSize || 32 * 1024;\n  options.deflateLevel = options.deflateLevel != null ? options.deflateLevel : 9;\n  options.deflateStrategy = options.deflateStrategy != null ? options.deflateStrategy : 3;\n  options.inputHasAlpha = options.inputHasAlpha != null ? options.inputHasAlpha : true;\n  options.deflateFactory = options.deflateFactory || zlib.createDeflate;\n  options.bitDepth = options.bitDepth || 8;\n  options.colorType = typeof options.colorType === 'number' ? options.colorType : constants.COLORTYPE_COLOR_ALPHA;\n\n  if (options.colorType !== constants.COLORTYPE_COLOR && options.colorType !== constants.COLORTYPE_COLOR_ALPHA) {\n    throw new Error('option color type:' + options.colorType + ' is not supported at present');\n  }\n\n  if (options.bitDepth !== 8) {\n    throw new Error('option bit depth:' + options.bitDepth + ' is not supported at present');\n  }\n};\n\nPacker.prototype.getDeflateOptions = function () {\n  return {\n    chunkSize: this._options.deflateChunkSize,\n    level: this._options.deflateLevel,\n    strategy: this._options.deflateStrategy\n  };\n};\n\nPacker.prototype.createDeflate = function () {\n  return this._options.deflateFactory(this.getDeflateOptions());\n};\n\nPacker.prototype.filterData = function (data, width, height) {\n  // convert to correct format for filtering (e.g. right bpp and bit depth)\n  var packedData = bitPacker(data, width, height, this._options); // filter pixel data\n\n  var bpp = constants.COLORTYPE_TO_BPP_MAP[this._options.colorType];\n  var filteredData = filter(packedData, width, height, this._options, bpp);\n  return filteredData;\n};\n\nPacker.prototype._packChunk = function (type, data) {\n  var len = data ? data.length : 0;\n  var buf = new Buffer(len + 12);\n  buf.writeUInt32BE(len, 0);\n  buf.writeUInt32BE(type, 4);\n\n  if (data) {\n    data.copy(buf, 8);\n  }\n\n  buf.writeInt32BE(CrcStream.crc32(buf.slice(4, buf.length - 4)), buf.length - 4);\n  return buf;\n};\n\nPacker.prototype.packGAMA = function (gamma) {\n  var buf = new Buffer(4);\n  buf.writeUInt32BE(Math.floor(gamma * constants.GAMMA_DIVISION), 0);\n  return this._packChunk(constants.TYPE_gAMA, buf);\n};\n\nPacker.prototype.packIHDR = function (width, height) {\n  var buf = new Buffer(13);\n  buf.writeUInt32BE(width, 0);\n  buf.writeUInt32BE(height, 4);\n  buf[8] = this._options.bitDepth; // Bit depth\n\n  buf[9] = this._options.colorType; // colorType\n\n  buf[10] = 0; // compression\n\n  buf[11] = 0; // filter\n\n  buf[12] = 0; // interlace\n\n  return this._packChunk(constants.TYPE_IHDR, buf);\n};\n\nPacker.prototype.packIDAT = function (data) {\n  return this._packChunk(constants.TYPE_IDAT, data);\n};\n\nPacker.prototype.packIEND = function () {\n  return this._packChunk(constants.TYPE_IEND, null);\n};","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/pngjs-nozlib/lib/packer.js"],"names":["constants","require","CrcStream","bitPacker","filter","zlib","Packer","module","exports","options","_options","deflateChunkSize","deflateLevel","deflateStrategy","inputHasAlpha","deflateFactory","createDeflate","bitDepth","colorType","COLORTYPE_COLOR_ALPHA","COLORTYPE_COLOR","Error","prototype","getDeflateOptions","chunkSize","level","strategy","filterData","data","width","height","packedData","bpp","COLORTYPE_TO_BPP_MAP","filteredData","_packChunk","type","len","length","buf","Buffer","writeUInt32BE","copy","writeInt32BE","crc32","slice","packGAMA","gamma","Math","floor","GAMMA_DIVISION","TYPE_gAMA","packIHDR","TYPE_IHDR","packIDAT","TYPE_IDAT","packIEND","TYPE_IEND"],"mappings":"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","sourcesContent":["'use strict';\n\nvar constants = require('./constants');\nvar CrcStream = require('./crc');\nvar bitPacker = require('./bitpacker');\nvar filter = require('./filter-pack');\nvar zlib = require('zlib');\n\nvar Packer = module.exports = function(options) {\n  this._options = options;\n\n  options.deflateChunkSize = options.deflateChunkSize || 32 * 1024;\n  options.deflateLevel = options.deflateLevel != null ? options.deflateLevel : 9;\n  options.deflateStrategy = options.deflateStrategy != null ? options.deflateStrategy : 3;\n  options.inputHasAlpha = options.inputHasAlpha != null ? options.inputHasAlpha : true;\n  options.deflateFactory = options.deflateFactory || zlib.createDeflate;\n  options.bitDepth = options.bitDepth || 8;\n  options.colorType = (typeof options.colorType === 'number') ? options.colorType : constants.COLORTYPE_COLOR_ALPHA;\n\n  if (options.colorType !== constants.COLORTYPE_COLOR && options.colorType !== constants.COLORTYPE_COLOR_ALPHA) {\n    throw new Error('option color type:' + options.colorType + ' is not supported at present');\n  }\n  if (options.bitDepth !== 8) {\n    throw new Error('option bit depth:' + options.bitDepth + ' is not supported at present');\n  }\n};\n\nPacker.prototype.getDeflateOptions = function() {\n  return {\n    chunkSize: this._options.deflateChunkSize,\n    level: this._options.deflateLevel,\n    strategy: this._options.deflateStrategy\n  };\n};\n\nPacker.prototype.createDeflate = function() {\n  return this._options.deflateFactory(this.getDeflateOptions());\n};\n\nPacker.prototype.filterData = function(data, width, height) {\n  // convert to correct format for filtering (e.g. right bpp and bit depth)\n  var packedData = bitPacker(data, width, height, this._options);\n\n  // filter pixel data\n  var bpp = constants.COLORTYPE_TO_BPP_MAP[this._options.colorType];\n  var filteredData = filter(packedData, width, height, this._options, bpp);\n  return filteredData;\n};\n\nPacker.prototype._packChunk = function(type, data) {\n\n  var len = (data ? data.length : 0);\n  var buf = new Buffer(len + 12);\n\n  buf.writeUInt32BE(len, 0);\n  buf.writeUInt32BE(type, 4);\n\n  if (data) {\n    data.copy(buf, 8);\n  }\n\n  buf.writeInt32BE(CrcStream.crc32(buf.slice(4, buf.length - 4)), buf.length - 4);\n  return buf;\n};\n\nPacker.prototype.packGAMA = function(gamma) {\n  var buf = new Buffer(4);\n  buf.writeUInt32BE(Math.floor(gamma * constants.GAMMA_DIVISION), 0);\n  return this._packChunk(constants.TYPE_gAMA, buf);\n};\n\nPacker.prototype.packIHDR = function(width, height) {\n\n  var buf = new Buffer(13);\n  buf.writeUInt32BE(width, 0);\n  buf.writeUInt32BE(height, 4);\n  buf[8] = this._options.bitDepth;  // Bit depth\n  buf[9] = this._options.colorType; // colorType\n  buf[10] = 0; // compression\n  buf[11] = 0; // filter\n  buf[12] = 0; // interlace\n\n  return this._packChunk(constants.TYPE_IHDR, buf);\n};\n\nPacker.prototype.packIDAT = function(data) {\n  return this._packChunk(constants.TYPE_IDAT, data);\n};\n\nPacker.prototype.packIEND = function() {\n  return this._packChunk(constants.TYPE_IEND, null);\n};"]},"metadata":{},"sourceType":"script"}