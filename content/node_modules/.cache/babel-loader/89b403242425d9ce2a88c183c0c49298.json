{"ast":null,"code":"import { decomposeRsaPublicKey, composeRsaPublicKey } from '../raw/keys';\nimport { decodeAsn1, encodeAsn1 } from '../../util/asn1-encoder';\nimport { EcParameters } from '../../util/asn1-entities';\nimport { decodeEcPoint, encodeEcPoint } from '../../util/ec';\nimport { hexStringToUint8Array } from '../../util/binary';\nimport { UnsupportedAlgorithmError } from '../../util/errors';\nimport { OIDS, FLIPPED_OIDS } from '../../util/oids';\nimport { KEY_TYPES } from '../../util/key-types';\n\nconst decomposeRsaSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey: publicKeyAsn1\n  } = subjectPublicKeyInfo;\n  const keyAlgorithm = {\n    id: OIDS[algorithm.id]\n  };\n\n  switch (keyAlgorithm.id) {\n    case 'rsa-encryption':\n    case 'md2-with-rsa-encryption':\n    case 'md4-with-rsa-encryption':\n    case 'md5-with-rsa-encryption':\n    case 'sha1-with-rsa-encryption':\n    case 'sha224-with-rsa-encryption':\n    case 'sha256-with-rsa-encryption':\n    case 'sha384-with-rsa-encryption':\n    case 'sha512-with-rsa-encryption':\n    case 'sha512-224-with-rsa-encryption':\n    case 'sha512-256-with-rsa-encryption':\n      break;\n\n    /* istanbul ignore next */\n\n    case 'rsaes-oaep':\n      throw new UnsupportedAlgorithmError('RSA-OAEP keys are not yet supported');\n\n    /* istanbul ignore next */\n\n    case 'rsassa-pss':\n      throw new UnsupportedAlgorithmError('RSA-PSS keys are not yet supported');\n\n    /* istanbul ignore next */\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm OID '${algorithm.id}'`);\n  }\n\n  const {\n    keyData\n  } = decomposeRsaPublicKey(publicKeyAsn1.data);\n  return {\n    keyAlgorithm: {\n      id: OIDS[algorithm.id]\n    },\n    keyData\n  };\n};\n\nconst composeRsaSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  const rsaPublicKeyAsn1 = composeRsaPublicKey(keyAlgorithm, keyData);\n  return {\n    algorithm: {\n      id: FLIPPED_OIDS[keyAlgorithm.id],\n      parameters: hexStringToUint8Array('0500')\n    },\n    publicKey: {\n      unused: 0,\n      data: rsaPublicKeyAsn1\n    }\n  };\n};\n\nconst decomposeEcSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey\n  } = subjectPublicKeyInfo;\n  const ecParameters = decodeAsn1(algorithm.parameters, EcParameters); // Validate parameters\n\n  /* istanbul ignore if */\n\n  if (ecParameters.type !== 'namedCurve') {\n    throw new UnsupportedAlgorithmError('Only EC named curves are supported');\n  } // Ensure that the named curve is supported\n\n\n  const namedCurve = OIDS[ecParameters.value];\n\n  if (!namedCurve) {\n    throw new UnsupportedAlgorithmError(`Unsupported named curve OID '${ecParameters.value}'`);\n  } // Validate & get encoded point (public key)\n\n\n  const {\n    x,\n    y\n  } = decodeEcPoint(namedCurve, publicKey.data);\n  return {\n    keyAlgorithm: {\n      id: 'ec-public-key',\n      namedCurve\n    },\n    keyData: {\n      x,\n      y\n    }\n  };\n};\n\nconst composeEcSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  // Validate named curve\n  const namedCurveOid = FLIPPED_OIDS[keyAlgorithm.namedCurve];\n\n  if (!namedCurveOid) {\n    throw new UnsupportedAlgorithmError(`Unsupported named curve '${keyAlgorithm.namedCurve}'`);\n  } // Encode point (public key)\n\n\n  const encodedPoint = encodeEcPoint(keyAlgorithm.namedCurve, keyData.x, keyData.y);\n  const ecParametersAsn1 = encodeAsn1({\n    type: 'namedCurve',\n    value: namedCurveOid\n  }, EcParameters);\n  return {\n    algorithm: {\n      id: FLIPPED_OIDS[keyAlgorithm.id],\n      parameters: ecParametersAsn1\n    },\n    publicKey: {\n      unused: 0,\n      data: encodedPoint\n    }\n  };\n};\n\nconst decomposeEd25519SubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey\n  } = subjectPublicKeyInfo;\n  return {\n    keyAlgorithm: {\n      id: OIDS[algorithm.id]\n    },\n    keyData: {\n      bytes: publicKey.data\n    }\n  };\n};\n\nconst composeEd25519SubjectPublicKeyInfo = (keyAlgorithm, keyData) => ({\n  algorithm: {\n    id: FLIPPED_OIDS[keyAlgorithm.id]\n  },\n  publicKey: {\n    unused: 0,\n    data: keyData.bytes\n  }\n});\n\nexport const decomposeSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const keyType = KEY_TYPES[OIDS[subjectPublicKeyInfo.algorithm.id]];\n\n  switch (keyType) {\n    case 'rsa':\n      return decomposeRsaSubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    case 'ec':\n      return decomposeEcSubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    case 'ed25519':\n      return decomposeEd25519SubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm OID '${subjectPublicKeyInfo.algorithm.id}'`);\n  }\n};\nexport const composeSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  const keyType = KEY_TYPES[keyAlgorithm.id];\n\n  switch (keyType) {\n    case 'rsa':\n      return composeRsaSubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    case 'ec':\n      return composeEcSubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    case 'ed25519':\n      return composeEd25519SubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm id '${keyAlgorithm.id}'`);\n  }\n};","map":{"version":3,"sources":["/home/al/Desktop/koi/narcissus/content/node_modules/crypto-key-composer/es/formats/spki/keys.js"],"names":["decomposeRsaPublicKey","composeRsaPublicKey","decodeAsn1","encodeAsn1","EcParameters","decodeEcPoint","encodeEcPoint","hexStringToUint8Array","UnsupportedAlgorithmError","OIDS","FLIPPED_OIDS","KEY_TYPES","decomposeRsaSubjectPublicKeyInfo","subjectPublicKeyInfo","algorithm","publicKey","publicKeyAsn1","keyAlgorithm","id","keyData","data","composeRsaSubjectPublicKeyInfo","rsaPublicKeyAsn1","parameters","unused","decomposeEcSubjectPublicKeyInfo","ecParameters","type","namedCurve","value","x","y","composeEcSubjectPublicKeyInfo","namedCurveOid","encodedPoint","ecParametersAsn1","decomposeEd25519SubjectPublicKeyInfo","bytes","composeEd25519SubjectPublicKeyInfo","decomposeSubjectPublicKeyInfo","keyType","composeSubjectPublicKeyInfo"],"mappings":"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","sourcesContent":["import { decomposeRsaPublicKey, composeRsaPublicKey } from '../raw/keys';\nimport { decodeAsn1, encodeAsn1 } from '../../util/asn1-encoder';\nimport { EcParameters } from '../../util/asn1-entities';\nimport { decodeEcPoint, encodeEcPoint } from '../../util/ec';\nimport { hexStringToUint8Array } from '../../util/binary';\nimport { UnsupportedAlgorithmError } from '../../util/errors';\nimport { OIDS, FLIPPED_OIDS } from '../../util/oids';\nimport { KEY_TYPES } from '../../util/key-types';\n\nconst decomposeRsaSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey: publicKeyAsn1\n  } = subjectPublicKeyInfo;\n  const keyAlgorithm = {\n    id: OIDS[algorithm.id]\n  };\n\n  switch (keyAlgorithm.id) {\n    case 'rsa-encryption':\n    case 'md2-with-rsa-encryption':\n    case 'md4-with-rsa-encryption':\n    case 'md5-with-rsa-encryption':\n    case 'sha1-with-rsa-encryption':\n    case 'sha224-with-rsa-encryption':\n    case 'sha256-with-rsa-encryption':\n    case 'sha384-with-rsa-encryption':\n    case 'sha512-with-rsa-encryption':\n    case 'sha512-224-with-rsa-encryption':\n    case 'sha512-256-with-rsa-encryption':\n      break;\n\n    /* istanbul ignore next */\n\n    case 'rsaes-oaep':\n      throw new UnsupportedAlgorithmError('RSA-OAEP keys are not yet supported');\n\n    /* istanbul ignore next */\n\n    case 'rsassa-pss':\n      throw new UnsupportedAlgorithmError('RSA-PSS keys are not yet supported');\n\n    /* istanbul ignore next */\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm OID '${algorithm.id}'`);\n  }\n\n  const {\n    keyData\n  } = decomposeRsaPublicKey(publicKeyAsn1.data);\n  return {\n    keyAlgorithm: {\n      id: OIDS[algorithm.id]\n    },\n    keyData\n  };\n};\n\nconst composeRsaSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  const rsaPublicKeyAsn1 = composeRsaPublicKey(keyAlgorithm, keyData);\n  return {\n    algorithm: {\n      id: FLIPPED_OIDS[keyAlgorithm.id],\n      parameters: hexStringToUint8Array('0500')\n    },\n    publicKey: {\n      unused: 0,\n      data: rsaPublicKeyAsn1\n    }\n  };\n};\n\nconst decomposeEcSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey\n  } = subjectPublicKeyInfo;\n  const ecParameters = decodeAsn1(algorithm.parameters, EcParameters); // Validate parameters\n\n  /* istanbul ignore if */\n\n  if (ecParameters.type !== 'namedCurve') {\n    throw new UnsupportedAlgorithmError('Only EC named curves are supported');\n  } // Ensure that the named curve is supported\n\n\n  const namedCurve = OIDS[ecParameters.value];\n\n  if (!namedCurve) {\n    throw new UnsupportedAlgorithmError(`Unsupported named curve OID '${ecParameters.value}'`);\n  } // Validate & get encoded point (public key)\n\n\n  const {\n    x,\n    y\n  } = decodeEcPoint(namedCurve, publicKey.data);\n  return {\n    keyAlgorithm: {\n      id: 'ec-public-key',\n      namedCurve\n    },\n    keyData: {\n      x,\n      y\n    }\n  };\n};\n\nconst composeEcSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  // Validate named curve\n  const namedCurveOid = FLIPPED_OIDS[keyAlgorithm.namedCurve];\n\n  if (!namedCurveOid) {\n    throw new UnsupportedAlgorithmError(`Unsupported named curve '${keyAlgorithm.namedCurve}'`);\n  } // Encode point (public key)\n\n\n  const encodedPoint = encodeEcPoint(keyAlgorithm.namedCurve, keyData.x, keyData.y);\n  const ecParametersAsn1 = encodeAsn1({\n    type: 'namedCurve',\n    value: namedCurveOid\n  }, EcParameters);\n  return {\n    algorithm: {\n      id: FLIPPED_OIDS[keyAlgorithm.id],\n      parameters: ecParametersAsn1\n    },\n    publicKey: {\n      unused: 0,\n      data: encodedPoint\n    }\n  };\n};\n\nconst decomposeEd25519SubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const {\n    algorithm,\n    publicKey\n  } = subjectPublicKeyInfo;\n  return {\n    keyAlgorithm: {\n      id: OIDS[algorithm.id]\n    },\n    keyData: {\n      bytes: publicKey.data\n    }\n  };\n};\n\nconst composeEd25519SubjectPublicKeyInfo = (keyAlgorithm, keyData) => ({\n  algorithm: {\n    id: FLIPPED_OIDS[keyAlgorithm.id]\n  },\n  publicKey: {\n    unused: 0,\n    data: keyData.bytes\n  }\n});\n\nexport const decomposeSubjectPublicKeyInfo = subjectPublicKeyInfo => {\n  const keyType = KEY_TYPES[OIDS[subjectPublicKeyInfo.algorithm.id]];\n\n  switch (keyType) {\n    case 'rsa':\n      return decomposeRsaSubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    case 'ec':\n      return decomposeEcSubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    case 'ed25519':\n      return decomposeEd25519SubjectPublicKeyInfo(subjectPublicKeyInfo);\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm OID '${subjectPublicKeyInfo.algorithm.id}'`);\n  }\n};\nexport const composeSubjectPublicKeyInfo = (keyAlgorithm, keyData) => {\n  const keyType = KEY_TYPES[keyAlgorithm.id];\n\n  switch (keyType) {\n    case 'rsa':\n      return composeRsaSubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    case 'ec':\n      return composeEcSubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    case 'ed25519':\n      return composeEd25519SubjectPublicKeyInfo(keyAlgorithm, keyData);\n\n    default:\n      throw new UnsupportedAlgorithmError(`Unsupported key algorithm id '${keyAlgorithm.id}'`);\n  }\n};"]},"metadata":{},"sourceType":"module"}