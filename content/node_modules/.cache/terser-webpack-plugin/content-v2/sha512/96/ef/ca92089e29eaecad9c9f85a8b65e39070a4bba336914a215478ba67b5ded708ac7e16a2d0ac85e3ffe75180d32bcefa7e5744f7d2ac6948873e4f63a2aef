{"code":"(this.webpackJsonpnarcissus=this.webpackJsonpnarcissus||[]).push([[0],{118:function(e,n){},270:function(e,n,t){},353:function(e,n){},355:function(e,n){},365:function(e,n){},367:function(e,n){},388:function(e,n){},463:function(e,n){},468:function(e,n){},470:function(e,n){},477:function(e,n){},489:function(e,n){},520:function(e,n){},547:function(e,n,t){},551:function(e,n,t){\"use strict\";t.r(n);var c=t(21),r=t.n(c),a=t(253),o=t.n(a),s=(t(270),t(2)),u=t.n(s),i=t(25),l=t(32),f=t(52),p=t(254),d=t(265),g=t.n(d),m=(t(547),t(23)),b=new p.Web;console.log(\"ktools\",b);var j=225;var h=function(){var e=Object(c.useState)(Object(m.jsx)(\"canvas\",{})),n=Object(f.a)(e,2),t=n[0],a=n[1],o=Object(c.useState)(!0),s=Object(f.a)(o,2),p=s[0],d=s[1],h=Object(c.useState)(0),v=Object(f.a)(h,2),y=v[0],O=v[1],x=Object(c.useRef)(null);Object(c.useEffect)((function(){w()}),[]),Object(c.useLayoutEffect)((function(){return function(){if(console.log(\"useEffect score\",x,\"score is\",y),x.current){var e=document.createElement(\"span\");e.innerText=y,e.className=\"scoreSpan\",x.current.appendChild(e)}else console.log(\"not updating score because\",x.current)}(),function(){var e,n=document.getElementsByClassName(\"scoreSpan\"),t=Object(l.a)(n);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(c){t.e(c)}finally{t.f()}}}),[y]),Object(c.useLayoutEffect)((function(){if(console.log(\"useEffect\",x),!x.current)return console.log(\"not updating narcissus because\",x.current),void w();console.log(\"about to append because main is\",x.current,t);var e=document.createElement(\"span\");return e.innerText=y,e.className=\"scoreSpan\",t.className=\"narcissus\",x.current.appendChild(t),x.current.appendChild(e),function(){console.log(\"clean up\");var e,n=document.getElementsByClassName(\"narcissus\"),t=Object(l.a)(n);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(c){t.e(c)}finally{t.f()}}}),[t]);var w=function(){var e=Object(i.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:return n=e.sent,console.log(\"setting frame\",n),e.next=6,E(n);case 6:return e.abrupt(\"return\",{state:undefined,id:undefined});case 7:case\"end\":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function S(){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(u.a.mark((function e(){var n,t,c,r,a,o,s,i,f,p,d,g,m,h,v,y,x;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=window.location.pathname.split(\"/\")[1]||\"1ZjIecqKGYdGTFMWR9kdGrmi77lMmZnA6dxEzWulyjo\",e.next=4,b.readNftState(n);case 4:return t=e.sent,e.next=7,b.getContractState();case 7:c=e.sent,console.log(\"got state\",t),console.log(\"got koi\",c),r=t.decay.lockState||0,a=t.decay.lastLock,o=c.stateUpdate.trafficLogs.rewardReport,i=0,f=t.decay.lastMax||1,p=1,d=0,g=0,m=0,h=Object(l.a)(o);try{for(h.s();!(v=h.n()).done;)(y=v.value).dailyTrafficBlock>a&&(y.logsSummary,Object.keys(y.logsSummary).includes(n)&&((x=y.logsSummary[n])<f?(d===m-1&&(p+=p),m-10<g&&(p*=-1),i+=x*(1+p/100)):(f=x,g=m,i+=1e4),d=m)),m+=1}catch(u){h.e(u)}finally{h.f()}return i<1?(console.log(\"returning current\",r),s=r):(s=(j-r)*(10001-i))>j?s=j:s<0&&(s=0),console.log(\"newScore is\",s),O(s),e.abrupt(\"return\",s);case 27:return e.prev=27,e.t0=e.catch(0),console.log(\"error loading nft data\",e.t0),O(1),e.abrupt(\"return\",1);case 32:case\"end\":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function E(e){return C.apply(this,arguments)}function C(){return(C=Object(i.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",new Promise((function(e,t){try{g()({url:\"./img/narcissus.gif\",frames:\"0-1000\",outputType:\"canvas\"}).then((function(t){var c=t[n].getImage();a(c),d(!1),e(t)})).catch(console.error.bind(console))}catch(c){console.log(\"err\",c),t(c)}})));case 1:case\"end\":return e.stop()}}),e)})))).apply(this,arguments)}return Object(m.jsxs)(\"div\",{className:\"App\",children:[p&&Object(m.jsx)(\"img\",{alt:\"this is the loading icon\",src:window.location.origin+\"/img/narcissus.gif\"}),!p&&Object(m.jsxs)(r.a.Fragment,{children:[Object(m.jsx)(\"header\",{}),Object(m.jsx)(\"main\",{ref:x}),Object(m.jsx)(\"img\",{src:\"./img/narcissus.gif\"})]})]})},v=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,552)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,a=n.getLCP,o=n.getTTFB;t(e),c(e),r(e),a(e),o(e)}))};o.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(h,{})}),document.getElementById(\"root\")),v()}},[[551,1,2]]]);","name":"static/js/main.2abe2a7e.chunk.js","map":{"version":3,"sources":["static/js/main.2abe2a7e.chunk.js"],"names":["this","push","module","exports","__webpack_require__","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","regenerator","regenerator_default","asyncToGenerator","createForOfIteratorHelper","slicedToArray","web","gif_frames","gif_frames_default","jsx_runtime","ktools","console","log","totalFrames","src_App","_useState","Object","_useState2","narcissus","setNarcissus","_useState3","_useState4","loading","setLoading","_useState5","_useState6","score","setScore","mainRef","init","current","scoreSpan","document","createElement","innerText","className","appendChild","updateScore","_step","spans","getElementsByClassName","_iterator","s","done","value","remove","err","e","f","_step2","narci","_iterator2","_ref","a","mark","_callee","correctFreezeFrame","wrap","_context","prev","next","getCorrectFreezeFrame","sent","setGif","abrupt","state","id","stop","apply","arguments","_getCorrectFreezeFrame","_callee2","oid","nft_state","koii_state","lockBlock","list","newScore","change","max","scalar","last","lastMax","i","_iterator3","_step3","item","aScore","_context2","window","location","pathname","split","readNftState","getContractState","decay","lockState","lastLock","stateUpdate","trafficLogs","rewardReport","dailyTrafficBlock","logsSummary","keys","includes","t0","_x","_setGif","_callee3","frameToSet","_context3","Promise","resolve","reject","url","frames","outputType","then","frameData","obj","getImage","catch","error","bind","children","alt","src","origin","Fragment","ref","src_reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","render","StrictMode","getElementById"],"mappings":"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"},"input":"(this[\"webpackJsonpnarcissus\"] = this[\"webpackJsonpnarcissus\"] || []).push([[0],{\n\n/***/ 118:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 270:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 353:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 355:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 365:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 367:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 388:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 463:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 468:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 470:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 477:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 489:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 520:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 547:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 551:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(21);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: ./node_modules/react-dom/index.js\nvar react_dom = __webpack_require__(253);\nvar react_dom_default = /*#__PURE__*/__webpack_require__.n(react_dom);\n\n// EXTERNAL MODULE: ./src/index.css\nvar src = __webpack_require__(270);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js\nvar regenerator = __webpack_require__(2);\nvar regenerator_default = /*#__PURE__*/__webpack_require__.n(regenerator);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\nvar asyncToGenerator = __webpack_require__(25);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\nvar createForOfIteratorHelper = __webpack_require__(32);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js + 3 modules\nvar slicedToArray = __webpack_require__(52);\n\n// EXTERNAL MODULE: ./node_modules/@_koi/sdk/web.js\nvar web = __webpack_require__(254);\n\n// EXTERNAL MODULE: ./node_modules/gif-frames/gif-frames.js\nvar gif_frames = __webpack_require__(265);\nvar gif_frames_default = /*#__PURE__*/__webpack_require__.n(gif_frames);\n\n// EXTERNAL MODULE: ./src/App.css\nvar App = __webpack_require__(547);\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(23);\n\n// CONCATENATED MODULE: ./src/App.js\n// import SmartWeave from \"smartweave\";\nvar ktools=new web[\"Web\"]();console.log(\"ktools\",ktools);var state;var id;var koii;var totalFrames=225;function App_App(){var _useState=Object(react[\"useState\"])(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"canvas\",{})),_useState2=Object(slicedToArray[\"a\" /* default */])(_useState,2),narcissus=_useState2[0],setNarcissus=_useState2[1];var _useState3=Object(react[\"useState\"])(true),_useState4=Object(slicedToArray[\"a\" /* default */])(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=Object(react[\"useState\"])(0),_useState6=Object(slicedToArray[\"a\" /* default */])(_useState5,2),score=_useState6[0],setScore=_useState6[1];// const [canvas, setCanvas] = useState(<canvas></canvas>);\nvar mainRef=Object(react[\"useRef\"])(null);Object(react[\"useEffect\"])(function(){init();},[]);var updateScore=function updateScore(){// for ( let child of mainRef.current.children ) {\n//   child.delete()\n// }\nconsole.log(\"useEffect score\",mainRef,'score is',score);if(!mainRef.current){console.log('not updating score because',mainRef.current);// updateScore(); // hacky - should be removed\nreturn;}else{var scoreSpan=document.createElement('span');scoreSpan.innerText=score;scoreSpan.className=\"scoreSpan\";mainRef.current.appendChild(scoreSpan);}};Object(react[\"useLayoutEffect\"])(function(){updateScore();// Clean up\nreturn function(){var spans=document.getElementsByClassName('scoreSpan');var _iterator=Object(createForOfIteratorHelper[\"a\" /* default */])(spans),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var span=_step.value;span.remove();}}catch(err){_iterator.e(err);}finally{_iterator.f();}};},[score]);Object(react[\"useLayoutEffect\"])(function(){// for ( let child of mainRef.current.children ) {\n//   child.delete()\n// }\nconsole.log(\"useEffect\",mainRef);if(!mainRef.current){console.log('not updating narcissus because',mainRef.current);init();// hacky - should be removed\nreturn;}else{console.log('about to append because main is',mainRef.current,narcissus);var scoreSpan=document.createElement('span');scoreSpan.innerText=score;scoreSpan.className=\"scoreSpan\";narcissus.className='narcissus';mainRef.current.appendChild(narcissus);mainRef.current.appendChild(scoreSpan);}// Clean up\nreturn function(){console.log(\"clean up\");// mainRef.current.innerHTML = null\nvar narci=document.getElementsByClassName('narcissus');var _iterator2=Object(createForOfIteratorHelper[\"a\" /* default */])(narci),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var n=_step2.value;n.remove();}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}};},[narcissus]);/* -- Functions -- */var init=/*#__PURE__*/function(){var _ref=Object(asyncToGenerator[\"a\" /* default */])(/*#__PURE__*/regenerator_default.a.mark(function _callee(){var correctFreezeFrame;return regenerator_default.a.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getCorrectFreezeFrame();case 2:correctFreezeFrame=_context.sent;console.log('setting frame',correctFreezeFrame);_context.next=6;return setGif(correctFreezeFrame);case 6:return _context.abrupt(\"return\",{state:state,id:id});case 7:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();function getCorrectFreezeFrame(){return _getCorrectFreezeFrame.apply(this,arguments);}function _getCorrectFreezeFrame(){_getCorrectFreezeFrame=Object(asyncToGenerator[\"a\" /* default */])(/*#__PURE__*/regenerator_default.a.mark(function _callee2(){var oid,nft_state,koii_state,current,lockBlock,list,newScore,change,max,scalar,last,lastMax,i,_iterator3,_step3,item,aScore,remainder;return regenerator_default.a.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;oid=window.location.pathname.split('/')[1]||'1ZjIecqKGYdGTFMWR9kdGrmi77lMmZnA6dxEzWulyjo';// console.log('got oid', oid)\n_context2.next=4;return ktools.readNftState(oid);case 4:nft_state=_context2.sent;_context2.next=7;return ktools.getContractState();case 7:koii_state=_context2.sent;console.log('got state',nft_state);console.log('got koi',koii_state);// contract state\ncurrent=nft_state.decay.lockState||0;lockBlock=nft_state.decay.lastLock;list=koii_state.stateUpdate.trafficLogs.rewardReport;// this will contain the output\n// looping variables\nchange=0;max=nft_state.decay.lastMax||1;scalar=1;last=0;lastMax=0;i=0;_iterator3=Object(createForOfIteratorHelper[\"a\" /* default */])(list);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){item=_step3.value;// console.log('checking', i, 'change is ', change)\nif(item.dailyTrafficBlock>lockBlock){if(typeof item.logsSummary&&Object.keys(item.logsSummary).includes(oid)){aScore=item.logsSummary[oid];if(aScore<max){if(last===i-1){// if we are on a streak, incremement the scalar\nscalar=scalar+scalar;}if(i-10<lastMax){// we are in a recovery slump, so the scalar is negative now\nscalar=-1*scalar;}// increment the adjustment \nchange=change+aScore*(1+scalar/100);}else{// if we have a new max we get a major boost\nmax=aScore;lastMax=i;change=change+10000;}last=i;}}i=i+1;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}if(change<1){// return current;\nconsole.log('returning current',current);newScore=current;// return 200;\n}else{// return current + change;\nremainder=totalFrames-current;// the maximum score adjustment we can give (total frames less current score)\nnewScore=remainder*(10001-change);if(newScore>totalFrames){newScore=totalFrames;}else if(newScore<0){newScore=0;}}// newScore = 200; // enable to check gif scrolling locally\nconsole.log('newScore is',newScore);setScore(newScore);return _context2.abrupt(\"return\",newScore);case 27:_context2.prev=27;_context2.t0=_context2[\"catch\"](0);console.log('error loading nft data',_context2.t0);setScore(1);return _context2.abrupt(\"return\",1);case 32:case\"end\":return _context2.stop();}}},_callee2,null,[[0,27]]);}));return _getCorrectFreezeFrame.apply(this,arguments);}function setGif(_x){return _setGif.apply(this,arguments);}// const renderImage = () => {\n//   // console.log(canvas, typeof(canvas), JSON.stringify(canvas))\n//   // for ( let child of mainRef.current.children ) {\n//   //   child.delete()\n//   // }\n//   console.log('CANVAAS', canvas, typeof(canvas))\n//   let copy = canvas.cloneNode(true)\n//   mainRef.current.insertAdjacentElement('afterbegin', copy)\n// }\nfunction _setGif(){_setGif=Object(asyncToGenerator[\"a\" /* default */])(/*#__PURE__*/regenerator_default.a.mark(function _callee3(frameToSet){return regenerator_default.a.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",new Promise(function(resolve,reject){try{gif_frames_default()({url:\"./img/narcissus.gif\",frames:\"0-1000\",outputType:\"canvas\"}).then(function(frameData){// console.log('setting frame', frameToSet, frameData[frameToSet])\nvar obj=frameData[frameToSet].getImage();setNarcissus(obj);setLoading(false);resolve(frameData);}).catch(console.error.bind(console));}catch(err){console.log(\"err\",err);reject(err);}}));case 1:case\"end\":return _context3.stop();}}},_callee3);}));return _setGif.apply(this,arguments);}return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"App\",children:[loading&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{alt:\"this is the loading icon\",src:window.location.origin+\"/img/narcissus.gif\"}),!loading&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(react_default.a.Fragment,{children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"header\",{}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"main\",{ref:mainRef}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:\"./img/narcissus.gif\"})]})]});}/* harmony default export */ var src_App = (App_App);// need to fetch the attention logs from koi state\n// then, iterate over the logs and sum the total attention\n// then, check the last time the nft was updated\n// then, check the nft's decay from it's state.decay\n// then, increment counters based on the difference of current block height and the block height at last adjustment\n// then, adjust the 'durability' score\n// CONCATENATED MODULE: ./src/reportWebVitals.js\nvar reportWebVitals=function reportWebVitals(onPerfEntry){if(onPerfEntry&&onPerfEntry instanceof Function){__webpack_require__.e(/* import() */ 3).then(__webpack_require__.bind(null, 552)).then(function(_ref){var getCLS=_ref.getCLS,getFID=_ref.getFID,getFCP=_ref.getFCP,getLCP=_ref.getLCP,getTTFB=_ref.getTTFB;getCLS(onPerfEntry);getFID(onPerfEntry);getFCP(onPerfEntry);getLCP(onPerfEntry);getTTFB(onPerfEntry);});}};/* harmony default export */ var src_reportWebVitals = (reportWebVitals);\n// CONCATENATED MODULE: ./src/index.js\nreact_dom_default.a.render(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(react_default.a.StrictMode,{children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(src_App,{})}),document.getElementById('root'));// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nsrc_reportWebVitals();\n\n/***/ })\n\n},[[551,1,2]]]);","inputSourceMap":{"version":3,"sources":["ignored /home/al/Desktop/koi/narcissus/content/node_modules/node-forge/lib crypto","/home/al/Desktop/koi/narcissus/content/node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-4-0!/home/al/Desktop/koi/narcissus/content/node_modules/css-loader/dist/cjs.js??ref--5-oneOf-4-1!/home/al/Desktop/koi/narcissus/content/node_modules/postcss-loader/src/index.js??postcss!/home/al/Desktop/koi/narcissus/content/src/index.css","ignored /home/al/Desktop/koi/narcissus/content/node_modules/hash-base/node_modules/readable-stream/lib util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/hash-base/node_modules/readable-stream/lib/internal/streams util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/readable-stream/lib util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/readable-stream/lib/internal/streams util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/bn.js/lib buffer","ignored /home/al/Desktop/koi/narcissus/content/node_modules/brorand crypto","ignored /home/al/Desktop/koi/narcissus/content/node_modules/browserify-sign/node_modules/readable-stream/lib util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/browserify-sign/node_modules/readable-stream/lib/internal/streams util","ignored /home/al/Desktop/koi/narcissus/content/node_modules/browserify-rsa/node_modules/bn.js/lib buffer","ignored /home/al/Desktop/koi/narcissus/content/node_modules/browserify-sign/node_modules/bn.js/lib buffer","ignored /home/al/Desktop/koi/narcissus/content/node_modules/gif-encoder/node_modules/readable-stream/lib util","/home/al/Desktop/koi/narcissus/content/node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-4-0!/home/al/Desktop/koi/narcissus/content/node_modules/css-loader/dist/cjs.js??ref--5-oneOf-4-1!/home/al/Desktop/koi/narcissus/content/node_modules/postcss-loader/src/index.js??postcss!/home/al/Desktop/koi/narcissus/content/src/App.css","/home/al/Desktop/koi/narcissus/content/src/App.js","/home/al/Desktop/koi/narcissus/content/src/reportWebVitals.js","/home/al/Desktop/koi/narcissus/content/src/index.js"],"names":["ktools","kweb","console","log","state","id","koii","totalFrames","App","useState","narcissus","setNarcissus","loading","setLoading","score","setScore","mainRef","useRef","useEffect","init","updateScore","current","scoreSpan","document","createElement","innerText","className","appendChild","useLayoutEffect","spans","getElementsByClassName","span","remove","narci","n","getCorrectFreezeFrame","correctFreezeFrame","setGif","oid","window","location","pathname","split","readNftState","nft_state","getContractState","koii_state","decay","lockState","lockBlock","lastLock","list","stateUpdate","trafficLogs","rewardReport","change","max","lastMax","scalar","last","i","item","dailyTrafficBlock","logsSummary","Object","keys","includes","aScore","newScore","remainder","frameToSet","Promise","resolve","reject","gifFrames","url","frames","outputType","then","frameData","obj","getImage","catch","error","bind","err","origin","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","getElementById"],"mappings":"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","file":"x","sourcesContent":["/* (ignored) */","// extracted by mini-css-extract-plugin","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","// extracted by mini-css-extract-plugin","import React, { useState, useEffect, useLayoutEffect, useRef } from \"react\";\n\nimport * as kweb from \"@_koi/sdk/web\";\nimport gifFrames from \"gif-frames\";\n// import SmartWeave from \"smartweave\";\n\nimport \"./App.css\";\n\nconst ktools = new kweb.Web();\n\nconsole.log(\"ktools\", ktools);\n\nlet state;\nlet id;\nlet koii;\nlet totalFrames = 225;\n\nfunction App() {\n  const [narcissus, setNarcissus] = useState(<canvas></canvas>);\n  const [loading, setLoading] = useState(true);\n  const [score, setScore] = useState(0);\n  // const [canvas, setCanvas] = useState(<canvas></canvas>);\n  const mainRef = useRef(null);\n\n  useEffect(() => {\n    init();\n  }, []);\n\n  const updateScore = () => {\n      // for ( let child of mainRef.current.children ) {\n    //   child.delete()\n    // }\n    console.log(\"useEffect score\", mainRef, 'score is', score);\n    if (!mainRef.current) {\n      console.log('not updating score because', mainRef.current)\n      // updateScore(); // hacky - should be removed\n      return;\n    } else {\n      let scoreSpan = document.createElement('span')\n          scoreSpan.innerText = score;\n          scoreSpan.className = \"scoreSpan\"\n        \n      mainRef.current.appendChild(scoreSpan);\n    }\n  }\n\n  useLayoutEffect(() => {\n    updateScore();\n\n    // Clean up\n    return () => {\n      var spans = document.getElementsByClassName('scoreSpan')\n      for ( let span of spans ) {\n        span.remove()\n      }\n    };\n  }, [score]);\n\n  useLayoutEffect(() => {\n    // for ( let child of mainRef.current.children ) {\n    //   child.delete()\n    // }\n    console.log(\"useEffect\", mainRef);\n    if (!mainRef.current) {\n      console.log('not updating narcissus because', mainRef.current)\n      init(); // hacky - should be removed\n      return;\n    } else {\n      console.log('about to append because main is', mainRef.current, narcissus)\n      let scoreSpan = document.createElement('span')\n          scoreSpan.innerText = score;\n          scoreSpan.className = \"scoreSpan\"\n      narcissus.className = 'narcissus'\n      mainRef.current.appendChild(narcissus);\n      mainRef.current.appendChild(scoreSpan);\n    }\n\n    // Clean up\n    return () => {\n      console.log(\"clean up\");\n      // mainRef.current.innerHTML = null\n      let narci = document.getElementsByClassName('narcissus')\n      for ( let n of narci ) {\n        n.remove()\n      }\n\n    };\n  }, [narcissus]);\n\n  /* -- Functions -- */\n\n  const init = async () => {\n    // should add the following flower to the view, replacing the loading icon\n    let correctFreezeFrame = await getCorrectFreezeFrame()\n    console.log('setting frame', correctFreezeFrame)\n    await setGif(correctFreezeFrame);\n\n    return { state, id };\n  };\n\n  async function getCorrectFreezeFrame() {\n    try {\n      var oid = (window.location.pathname).split('/')[1] || '1ZjIecqKGYdGTFMWR9kdGrmi77lMmZnA6dxEzWulyjo';\n      // console.log('got oid', oid)\n      var nft_state = await ktools.readNftState(oid);\n      var koii_state = await ktools.getContractState();\n      console.log('got state', nft_state)\n      console.log('got koi', koii_state)\n      \n      // contract state\n      let current = nft_state.decay.lockState || 0;\n      let lockBlock = nft_state.decay.lastLock;\n      let list = koii_state.stateUpdate.trafficLogs.rewardReport;\n      let newScore; // this will contain the output\n\n      // looping variables\n      let change = 0;\n      let max = nft_state.decay.lastMax || 1;\n      let scalar = 1;\n      let last = 0;\n      let lastMax = 0;\n      let i = 0;\n\n      for ( var item of list ) {\n        // console.log('checking', i, 'change is ', change)\n        if ( item.dailyTrafficBlock > lockBlock ) { \n            if ( typeof(item.logsSummary) && Object.keys(item.logsSummary).includes(oid) ) {\n              let aScore = item.logsSummary[oid];\n              if ( aScore < max ) {\n                \n                if ( last === i - 1 ) {\n                  // if we are on a streak, incremement the scalar\n                  scalar = scalar + scalar;\n                }\n                \n                if ( ( i - 10 ) < lastMax ) {\n                  // we are in a recovery slump, so the scalar is negative now\n                  scalar = ( -1 ) * scalar;\n                }\n                \n                // increment the adjustment \n                change = change + aScore * ( 1 + scalar / 100 )\n\n              } else {\n                // if we have a new max we get a major boost\n                max = aScore;\n                lastMax = i;\n                change = change + 10000;\n              }\n              last = i;\n            }\n        }\n        i = i + 1;\n      }\n      \n      if (change < 1) {\n        // return current;\n        console.log('returning current', current)\n        newScore = current;\n        // return 200;\n      } else {\n        // return current + change;\n        let remainder = totalFrames - current; // the maximum score adjustment we can give (total frames less current score)\n        newScore = remainder * ( 10001 - change );\n        if ( newScore > totalFrames ) {\n          newScore = totalFrames;\n        } else if ( newScore < 0 ) {\n          newScore = 0;\n        }\n      }\n      // newScore = 200; // enable to check gif scrolling locally\n      console.log('newScore is', newScore)\n      setScore(newScore);\n      return newScore;\n    } catch (err) {\n      console.log('error loading nft data', err)\n      setScore(1)\n      return 1;\n    }\n  }\n\n  async function setGif(frameToSet) {\n    return new Promise(function (resolve, reject) {\n      try {\n        gifFrames({ url: \"./img/narcissus.gif\", frames: \"0-1000\", outputType: \"canvas\" })\n          .then(function (frameData) {\n            // console.log('setting frame', frameToSet, frameData[frameToSet])\n            let obj = frameData[frameToSet].getImage();\n            setNarcissus(obj);\n            setLoading(false);\n            resolve(frameData);\n          })\n          .catch(console.error.bind(console));\n      } catch (err) {\n        console.log(\"err\", err);\n        reject(err);\n      }\n    });\n  }\n\n  // const renderImage = () => {\n\n  //   // console.log(canvas, typeof(canvas), JSON.stringify(canvas))\n\n  //   // for ( let child of mainRef.current.children ) {\n  //   //   child.delete()\n  //   // }\n\n  //   console.log('CANVAAS', canvas, typeof(canvas))\n\n  //   let copy = canvas.cloneNode(true)\n\n  //   mainRef.current.insertAdjacentElement('afterbegin', copy)\n  // }\n\n  return (\n    <div className=\"App\">\n      {loading && (\n        <img alt=\"this is the loading icon\" src={window.location.origin + \"/img/narcissus.gif\"} />\n      )}\n      {!loading && (\n        <React.Fragment>\n          <header></header>\n          <main ref={mainRef}></main>\n          <img src=\"./img/narcissus.gif\"></img>\n        </React.Fragment>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n\n// need to fetch the attention logs from koi state\n// then, iterate over the logs and sum the total attention\n// then, check the last time the nft was updated\n// then, check the nft's decay from it's state.decay\n// then, increment counters based on the difference of current block height and the block height at last adjustment\n// then, adjust the 'durability' score\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"]}}